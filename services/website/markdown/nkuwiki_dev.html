<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="Markdown" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>ğŸ“šnkuwikiå¼€å‘æ–‡æ¡£ | å—å¼€WIKI</title>
    <meta name="description" content="æˆ‘ä»¬è‡´åŠ›äºæ„å»º**å—å¼€çŸ¥è¯†å…±åŒä½“**ï¼Œè·µè¡Œ **å¼€æºÂ·å…±æ²»Â·æ™®æƒ ** ä¸‰ä½ä¸€ä½“ä»·å€¼ä½“ç³»" />
    <style>
      :root {
        --vp-c-bg: #fff;
        --vp-c-text: #2c3e50;
        --vp-c-border: #eaecef;
        --vp-c-code-bg: #f6f8fa;
        --vp-c-brand: #3eaf7c;
        --vp-c-brand-light: #4abf8a;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
        --vp-c-text: #f0f0f0;
        --vp-c-border: #3e3e3e;
        --vp-c-code-bg: #282c34;
        --vp-c-brand: #3aa675;
        --vp-c-brand-light: #349469;
      }

      html, body {
        background: var(--vp-c-bg);
        color: var(--vp-c-text);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        line-height: 1.7;
      }

      .markdown-container {
        max-width: 960px;
        margin: 0 auto;
        padding: 2rem 2.5rem;
      }

      .markdown-content {
        background-color: var(--vp-c-bg);
        border-radius: 8px;
        padding: 2rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .markdown-content h1 {
        font-size: 2.2rem;
        border-bottom: 1px solid var(--vp-c-border);
        padding-bottom: 0.3rem;
        margin-top: 0;
      }

      .markdown-content h2 {
        font-size: 1.65rem;
        border-bottom: 1px solid var(--vp-c-border);
        padding-bottom: 0.3rem;
      }

      .markdown-content h3 {
        font-size: 1.35rem;
      }

      .markdown-content h4 {
        font-size: 1.15rem;
      }

      .markdown-content p {
        margin: 1rem 0;
      }

      .markdown-content blockquote {
        border-left: 4px solid var(--vp-c-brand);
        padding: 0.5rem 1rem;
        color: #6a737d;
        background-color: rgba(66, 185, 131, 0.1);
        margin: 1rem 0;
      }

      .markdown-content pre {
        background-color: var(--vp-c-code-bg);
        border-radius: 6px;
        padding: 1rem;
        overflow: auto;
      }

      .markdown-content code {
        font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
        padding: 0.2rem 0.4rem;
        background-color: var(--vp-c-code-bg);
        border-radius: 3px;
      }

      .markdown-content pre code {
        padding: 0;
        background-color: transparent;
      }

      .markdown-content table {
        border-collapse: collapse;
        width: 100%;
        margin: 1rem 0;
      }

      .markdown-content table th, .markdown-content table td {
        border: 1px solid var(--vp-c-border);
        padding: 0.6rem 1rem;
        text-align: left;
      }

      .markdown-content table th {
        background-color: rgba(0, 0, 0, 0.05);
      }

      .markdown-content img {
        max-width: 100%;
      }

      .markdown-content a {
        color: var(--vp-c-brand);
        text-decoration: none;
      }

      .markdown-content a:hover {
        text-decoration: underline;
        color: var(--vp-c-brand-light);
      }

      .markdown-content ul, .markdown-content ol {
        padding-left: 2rem;
      }

      .markdown-content li {
        margin: 0.5rem 0;
      }

      /* è¿”å›æŒ‰é’® */
      .back-button {
        display: inline-block;
        margin-bottom: 1rem;
        padding: 0.5rem 1rem;
        background-color: var(--vp-c-brand);
        color: white;
        border-radius: 4px;
        text-decoration: none;
        font-weight: 500;
      }

      .back-button:hover {
        background-color: var(--vp-c-brand-light);
      }

      /* æš—é»‘æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
      .theme-toggle {
        position: fixed;
        right: 1.5rem;
        bottom: 1.5rem;
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        background-color: var(--vp-c-brand);
        color: white;
        text-align: center;
        line-height: 3rem;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
  </head>
  <body>
    <div class="markdown-container">
      <a href="/docs.html" class="back-button">Â« è¿”å›æ–‡æ¡£åˆ—è¡¨</a>
      <div class="markdown-content">
        <h1 id="nkuwiki">ğŸ“šnkuwikiå¼€å‘æ–‡æ¡£</h1>
<h2 id="_1">ğŸ¯ æ„¿æ™¯ä¸ç›®æ ‡</h2>
<p>æˆ‘ä»¬è‡´åŠ›äºæ„å»º<strong>å—å¼€çŸ¥è¯†å…±åŒä½“</strong>ï¼Œè·µè¡Œ <strong>å¼€æºÂ·å…±æ²»Â·æ™®æƒ </strong> ä¸‰ä½ä¸€ä½“ä»·å€¼ä½“ç³»
  ï¼ˆğŸ”“ æŠ€æœ¯å¼€æºé€æ˜ + ğŸ¤ ç¤¾åŒºååŒå…±æ²» + ğŸ†“ æœåŠ¡æ°¸ä¹…æ™®æƒ ï¼‰ï¼Œå®ç°ï¼š</p>
<ul>
<li>
<p>ğŸš€ <strong>æ¶ˆé™¤å—å¼€å­¦å­ä¿¡æ¯å·®è·</strong></p>
</li>
<li>
<p>ğŸ’¡ <strong>å¼€æ”¾çŸ¥è¯†èµ„æºå…è´¹è·å–</strong></p>
</li>
<li>
<p>ğŸŒ± <strong>æ„å»ºå¯æŒç»­çš„äº’åŠ©ç¤¾åŒº</strong></p>
</li>
</ul>
<p><strong>é¡¹ç›®äº®ç‚¹</strong>ï¼š</p>
<ul>
<li>ğŸ¤– <strong>å¼€æºçŸ¥è¯†ä¸­æ¢</strong></li>
<li>ğŸ§  åŒæ“é©±åŠ¨ï¼š<strong>RAG</strong>æ¡†æ¶ + <strong>SOTA</strong>æ¨¡å‹æ¨ç†</li>
<li>ğŸ”„ <strong>åŠ¨æ€çŸ¥è¯†å›¾è°±</strong><ul>
<li>ğŸ”“ æ¥å…¥<strong>å—å¼€å…¨æ¸ é“æ•°æ®æº</strong>ï¼ˆç½‘ç«™/å¾®ä¿¡å…¬ä¼—å·/æ ¡å›­é›†å¸‚/å°çº¢ä¹¦/å¾®åš/æŠ–éŸ³/Bç«™/çŸ¥ä¹etc.ï¼‰</li>
<li>ğŸ¤ <strong>ç¤¾åŒºå…±æ²»</strong>ï¼šå¿—æ„¿è€…å›¢é˜Ÿä¸ç”¨æˆ·ååŒç»´æŠ¤</li>
<li>ğŸ›¡ï¸ <strong>å¼€æºè¯„ä¼°æ¡†æ¶</strong>ï¼ˆè´¡çŒ®è€…é€æ˜å®¡è®¡ï¼‰</li>
</ul>
</li>
<li>
<p>ğŸ” å¤šæ¨¡æ€å’Œä¸°å¯Œæ’ä»¶æ”¯æŒ</p>
<ul>
<li>æ”¯æŒæ–‡æœ¬/è¯­éŸ³/å›¾åƒ/è§†é¢‘å…¨æ„Ÿå®˜çŸ¥è¯†è·å–</li>
<li>ä¸°å¯Œæ’ä»¶æ”¯æŒï¼šæœç´¢å¼•æ“ã€åˆ›æ„ç”Ÿå›¾ã€æ•°æ®åˆ†æetc.</li>
</ul>
</li>
<li>
<p>ğŸ‘¥ <strong>æ™®æƒ å…±æ²»æœºåˆ¶</strong></p>
</li>
<li>
<p>ä¸‰ç»´ååŒæ¶æ„ï¼š</p>
<ul>
<li>ğŸ’» <strong>æŠ€æœ¯å±‚</strong>ï¼šå¼€æºç¤¾åŒºç»´æŠ¤æ ¸å¿ƒæ ˆ</li>
<li>âš–ï¸ <strong>æ²»ç†å±‚</strong>ï¼šDAOå¼å†…å®¹å®¡æ ¸å§”å‘˜ä¼š</li>
<li>ğŸ‘¤ <strong>åº”ç”¨å±‚</strong>ï¼šè´¡çŒ®å³æ²»ç†ï¼ˆ1Token=1æŠ•ç¥¨æƒï¼‰</li>
</ul>
</li>
<li>
<p>ğŸ’ <strong>è´¡çŒ®æµé€šç³»ç»Ÿ</strong>ï¼š</p>
</li>
<li>ğŸ <strong>æ¿€åŠ±å…¨å‘¨æœŸè¦†ç›–</strong>ï¼ˆé‡‡é›†/æ¸…æ´—/æ ‡æ³¨ï¼‰</li>
<li>â™»ï¸ <strong>æ•°å­—æƒç›Šå…‘æ¢</strong>ï¼š<ul>
<li>âš¡ ä¼˜å…ˆè®¡ç®—èµ„æº</li>
<li>ğŸšï¸ ä¸ªæ€§åŒ–çŸ¥è¯†é—¨æˆ·</li>
<li>ğŸ—³ï¸ æ²»ç†ä»£è®®å¸­ä½</li>
</ul>
</li>
</ul>
<h2 id="_2">ğŸ— ç³»ç»Ÿæ¶æ„å›¾</h2>
<p>```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml</p>
<p>' ==== æ ‡é¢˜æ ·å¼è°ƒæ•´ ====
skinparam titleFontSize 20
skinparam titleFontName "Microsoft YaHei"
skinparam titleFontColor #1A237E</p>
<p>' ==== å¸ƒå±€å‚æ•° ====
skinparam nodesep 50
skinparam ranksep 150
skinparam linetype ortho
skinparam defaultFontSize 16
skinparam defaultFontName "Microsoft YaHei"
skinparam monochrome false
skinparam shadowing false
skinparam wrapWidth 150
skinparam nodeFontSize 14
skinparam defaultTextAlignment center
LAYOUT_LEFT_RIGHT()
LAYOUT_WITH_LEGEND()</p>
<p>title nkuwiki ç³»ç»Ÿæ¶æ„å…¨æ™¯å›¾\n<size:18>â€”â€”å¼€æºÂ·å…±æ²»Â·æ™®æƒ çš„å—å¼€çŸ¥è¯†ç”Ÿæ€</size></p>
<p>' ==== æ ¸å¿ƒæ¶æ„ ====</p>
<p>Person(user, "æ ¡å›­ç”¨æˆ·", "å¤šç»ˆç«¯è®¿é—®æœåŠ¡\nâ€¢ å¾®ä¿¡å…¬ä¼—å·\nâ€¢ ç½‘ç«™\nâ€¢ é£ä¹¦", $sprite="person2", $tags="user")
Person(volunteer, "å¿—æ„¿è€…", "çŸ¥è¯†åº“ç»´æŠ¤ä¸å®¡æ ¸", $sprite="person2", $tags="volunteer")
' ==== æ ¸å¿ƒç³»ç»Ÿå±‚ ====
System_Boundary(nkuwiki_core, "æ ¸å¿ƒç³»ç»Ÿå±‚") {
    ContainerDb(knowledge_db, "çŸ¥è¯†åº“", "FAISS", "å‘é‡åŒ–å­˜å‚¨\n1. åŠ¨æ€ç‰ˆæœ¬æ§åˆ¶\n2. å¢é‡æ›´æ–°ç´¢å¼•\n3. å¿—æ„¿è€…äººå·¥å›æ»š", $tags="core_db")
    Container(msg_broker, "æ¶ˆæ¯ä¸­æ¢", "RabbitMQ", "AMQPåè®®\n1. æŒä¹…åŒ–é˜Ÿåˆ—\n2. æ¶ˆæ¯ç¡®è®¤æœºåˆ¶\n3. æ¶ˆæ¯é‡è¯•æœºåˆ¶", $tags="mq")
    Container(ai_agent, "æ™ºèƒ½Agent", "Coze", "SOTA-LLMå¤šæ¨¡æ€äº¤äº’\n1. RAGå¢å¼º\n2. å·¥ä½œæµ\n3. æ’ä»¶è°ƒç”¨", $tags="ai")</p>
<p>}</p>
<p>' ==== ç³»ç»Ÿè°ƒåº¦å±‚ ====
System_Boundary(infra, "ç³»ç»Ÿè°ƒåº¦å±‚") {
    Container(apisix, "APIç½‘å…³", "Apache APISIX", "æµé‡æ§åˆ¶", $tags="infra")
    Container(otel, "ç›‘æ§ä½“ç³»", "OpenTelemetry", "å…¨é“¾è·¯è¿½è¸ª", $tags="monitor")
    Container(celery, "ä»»åŠ¡è°ƒåº¦", "Celery+Redis", "åˆ†å¸ƒå¼ä»»åŠ¡", $tags="scheduler")
}</p>
<p>' ==== æ•°æ®å±‚ ====
System_Boundary(data_layer, "æ•°æ®å±‚") {
 ContainerDb(structured_db, "ç»“æ„åŒ–å­˜å‚¨", "DuckDB", "å…³ç³»å‹æ•°æ®", $tags="core_db")
    ContainerDb(seaweedfs, "å¯¹è±¡å­˜å‚¨", "SeaweedFS", "éå…³ç³»å‹æ•°æ®", $tags="storage")
    Container(etl_engine, "ETLå¼•æ“", "Playwright+Selenium", "å¤šæºæ•°æ®å®æ—¶é‡‡é›†\n1. æ™ºèƒ½åçˆ¬\n2. æ•°æ®æ¸…æ´—\n3. æ•°æ®è½½å…¥", $tags="etl")</p>
<p>}</p>
<p>' ==== å¤–éƒ¨ç³»ç»Ÿ ====
System_Ext(plugins, "æ’ä»¶å¸‚åœº", "Coze API", $tags="ext")
System_Ext(data_sources, "æ•°æ®æº", "å¤šæ¸ é“è¾“å…¥\n1. ç½‘ç«™\n2. å¾®ä¿¡å…¬ä¼—å·\n3. æ ¡å›­é›†å¸‚\n4. å°çº¢ä¹¦\n5. ...", $tags="ext")</p>
<p>' ==== æ•°æ®æµå…³ç³» ====</p>
<p>' ç”¨æˆ·æµ
Rel(user, msg_broker, "è¯·æ±‚æœåŠ¡/æäº¤è´¡çŒ®", "å¾®ä¿¡/ç½‘ç«™/é£ä¹¦UI")
Rel(msg_broker, ai_agent, "è°ƒç”¨æœåŠ¡", "CozeAPI")
Rel(msg_broker, user, "æä¾›æœåŠ¡/å‘æ”¾token", "å¾®ä¿¡/ç½‘ç«™/é£ä¹¦UI")
Rel(ai_agent, plugins, "è°ƒç”¨æ’ä»¶", "CozeAPI")
Rel(ai_agent, knowledge_db, "RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰", "CozeAPI")</p>
<p>' å¿—æ„¿è€…æµ
Rel(volunteer, msg_broker, "äººå·¥å®¡æ ¸", "å¾®ä¿¡/ç½‘ç«™/é£ä¹¦UI")
Rel(volunteer, knowledge_db, "è¯„ä¼°æ ¡å‡†/è´¡çŒ®å…¥åº“", "admin")</p>
<p>' æ•°æ®ETLæµ
Rel(data_sources, etl_engine, "æ•°æ®é‡‡é›†", "HTTPS/API")
Rel(etl_engine, structured_db, "æ¸…æ´—/è½½å…¥æ•°æ®", "Python API")
Rel(etl_engine, seaweedfs, "æ¸…æ´—/è½½å…¥æ•°æ®", "Python API")
Rel(structured_db, msg_broker, "å…ƒæ•°æ®æ¨é€", "AMQP")
Rel(seaweedfs, msg_broker, "å…ƒæ•°æ®æ¨é€", "AMQP")
Rel(msg_broker, knowledge_db, "ç­›é€‰å…¥åº“", "gRPC")
Rel(ai_agent, msg_broker, "AIå®¡æ ¸", "CozeAPI")</p>
<p>' ç³»ç»Ÿç®¡ç†æµ
Rel(apisix, msg_broker, "æµé‡è·¯ç”±", "HTTPS")
Rel(celery, etl_engine, "ä»»åŠ¡è°ƒåº¦", "Redis Protocol")
Rel(celery, msg_broker, "ä»»åŠ¡è°ƒåº¦", "Redis Protocol")
Rel(otel, apisix, "ç›‘æ§é‡‡é›†", "OTLP")</p>
<p>' ==== æ ·å¼å®šä¹‰ ====
AddElementTag("core_db", $fontColor="#BF360C", $borderColor="#D84315", $bgColor="#FFCCBC")
AddElementTag("etl", $fontColor="#1B5E20", $borderColor="#43A047", $bgColor="#C8E6C9")
AddElementTag("mq", $fontColor="#004D40", $borderColor="#00796B", $bgColor="#B2DFDB")
AddElementTag("ai", $fontColor="#311B92", $borderColor="#673AB7", $bgColor="#D1C4E9")</p>
<p>note right of msg_broker
<color:#00796B><strong>æ¶ˆæ¯å¤„ç†æµç¨‹</strong></p>
<ol>
<li>
<p>æ¥æ”¶ç”¨æˆ·è´¡çŒ®</p>
</li>
<li>
<p>è´¨é‡è¯„ä¼°è¿‡æ»¤</p>
</li>
<li>
<p>è§¦å‘çŸ¥è¯†åº“æ›´æ–°</p>
</li>
<li>
<p>Tokenå‘æ”¾</p>
</li>
</ol>
<p>end note</p>
<p>note left of knowledge_db
<color:#D84315><strong>ç‰ˆæœ¬ç­–ç•¥</strong></p>
<ol>
<li>
<p>æ—¶é—´çª—å£å¿«ç…§</p>
</li>
<li>
<p>å¢é‡æ›´æ–°ç´¢å¼•</p>
</li>
<li>
<p>å¿—æ„¿è€…äººå·¥å›æ»š</p>
</li>
</ol>
<p>end note</p>
<p>' ==== æŠ€æœ¯æ ˆè¯´æ˜æ¨¡å— ====
left to right direction
package "é€šä¿¡åè®®" &lt;<Rectangle>&gt; {
  [RPC] as rpc #LightBlue
  [gRPC] as grpc #LightGreen
  [AMQP] as amqp #LightPink
}</p>
<p>package "åº”ç”¨åœºæ™¯" &lt;<Rectangle>&gt; {
  [æœåŠ¡é—´é€šä¿¡] as service_com
  [æ¶ˆæ¯é˜Ÿåˆ—] as mq
  [è·¨è¯­è¨€è°ƒç”¨] as cross_lang
}</p>
<p>rpc -[hidden]-&gt; grpc
grpc -[hidden]-&gt; amqp
service_com -[hidden]-&gt; mq
mq -[hidden]-&gt; cross_lang</p>
<p>rpc --&gt; service_com : "è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åŸºç¡€æ¨¡å¼"
grpc --&gt; cross_lang : "Googleå¼€å‘çš„\nç°ä»£RPCæ¡†æ¶"
amqp --&gt; mq : "é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®"</p>
<p>note top of rpc
<color:#1E88E5>RPCï¼ˆRemote Procedure Callï¼‰
åŸºç¡€é€šä¿¡èŒƒå¼ï¼Œå…è®¸åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·
è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼Œä¸é™å®šå…·ä½“åè®®
end note</p>
<p>note top of grpc
<color:#43A047>gRPCç‰¹æ€§ï¼š</p>
<ul>
<li>
<p>åŸºäºHTTP/2</p>
</li>
<li>
<p>ä½¿ç”¨Protocol Buffers</p>
</li>
<li>
<p>æ”¯æŒåŒå‘æµ</p>
</li>
<li>
<p>å¾®æœåŠ¡åœºæ™¯æ€§èƒ½æå‡40%+
end note</p>
</li>
</ul>
<p>note top of amqp
<color:#D81B60>AMQPï¼ˆAdvanced Message Queuing Protocolï¼‰
ä¼ä¸šçº§æ¶ˆæ¯æ ‡å‡†ï¼š</p>
<ul>
<li>
<p>æŒä¹…åŒ–</p>
</li>
<li>
<p>äº‹åŠ¡æ”¯æŒ</p>
</li>
<li>
<p>å‘å¸ƒ/è®¢é˜…æ¨¡å¼</p>
</li>
<li>
<p>å—å¼€æ¶æ„ä¸­ç”¨äºTokenå‘æ”¾ç­‰å¼‚æ­¥åœºæ™¯
end note
@enduml</p>
</li>
</ul>
<p>```text</p>
<h2 id="_3">ğŸ“… æ¼”è¿›è·¯çº¿</h2>
<table>
<thead>
<tr>
<th>é˜¶æ®µ</th>
<th>å…³é”®é‡Œç¨‹ç¢‘</th>
<th>æŠ€æœ¯æ ˆä¸æ¶æ„å†³ç­–</th>
<th>äº¤ä»˜äº§ç‰©</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>MVPå¯åŠ¨æœŸ</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>(0-3æœˆ)</td>
<td>âœ… æ ¸å¿ƒæœåŠ¡ä¸Šçº¿</td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª å¾®ä¿¡å…¬ä¼—å·æ™ºèƒ½é—®ç­”MVP</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª åŠ¨æ€çˆ¬è™«æ¡†æ¶1.0</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª é‡ç‚¹å¹³å°æ•°æ®æ¥å…¥ï¼ˆå®˜ç½‘/å…¬ä¼—å·ï¼‰</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª çŸ¥è¯†åº“åŸºç¡€æ£€ç´¢åŠŸèƒ½</td>
<td>ğŸ›  FastAPIï¼ˆAPIç½‘å…³ï¼‰</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ¤– Cozeï¼ˆæ™ºèƒ½Agentï¼‰</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ•· Playwrightï¼ˆè‡ªåŠ¨åŒ–çˆ¬è™«ï¼‰</td>
<td>ğŸ“¦ å®¹å™¨åŒ–æ ¸å¿ƒæœåŠ¡</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ“š éƒ¨ç½²æŒ‡å—+è¿ç»´æ‰‹å†Œ</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ” çŸ¥è¯†åº“æ£€ç´¢APIæ–‡æ¡£</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>ç”Ÿæ€æ„å»ºæœŸ</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>(4-6æœˆ)</td>
<td>ğŸš€ æ ¸å¿ƒç³»ç»Ÿæ‰©å±•</td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª å…¨å¹³å°çˆ¬è™«è¦†ç›–</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª æ•°æ®è´¨é‡çœ‹æ¿1.0</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª ç”¨æˆ·è´¡çŒ®ç³»ç»ŸåŸå‹</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª åçˆ¬ç­–ç•¥å¢å¼º</td>
<td>ğŸ•¸ Scrapyï¼ˆåˆ†å¸ƒå¼çˆ¬è™«ï¼‰</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ“Š Prometheus+Granfanaï¼ˆç›‘æ§ï¼‰</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ” JWT+RBACï¼ˆæƒé™æ§åˆ¶ï¼‰</td>
<td>ğŸ§© å¯æ’æ‹”çˆ¬è™«æ¡†æ¶</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ“ˆ è´¨é‡è¯„ä¼°ç³»ç»Ÿ</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸª™ Tokenæ¿€åŠ±åŸå‹ç³»ç»Ÿ</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>ä½“ç³»å‡çº§æœŸ</strong></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>(7-9æœˆ)</td>
<td>ğŸŒŸ ç³»ç»Ÿæ¶æ„æ¼”è¿›</td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª å¾®æœåŠ¡åŒ–æ”¹é€ </td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª åˆ†å¸ƒå¼ç§¯åˆ†ç³»ç»Ÿ</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª å…¨é“¾è·¯ç›‘æ§ä½“ç³»</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>â–ª å¤šæ¨¡æ€çŸ¥è¯†å¼•æ“</td>
<td>â˜ Spring Cloud Alibabaï¼ˆå¾®æœåŠ¡ï¼‰</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ“¦ ELKï¼ˆæ—¥å¿—åˆ†æï¼‰</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ§  Milvusï¼ˆå‘é‡æ£€ç´¢ï¼‰</td>
<td>ğŸ”„ ç§¯åˆ†ç³»ç»Ÿå¾®æœåŠ¡é›†ç¾¤</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ‘ï¸ ç³»ç»Ÿå¥åº·çœ‹æ¿</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ğŸ¨ å¤šæ¨¡æ€å¤„ç†SDK</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>å°å›¢é˜Ÿæ¼”è¿›ç­–ç•¥</strong>ï¼š</p>
<ol>
<li>
<p>ğŸ¯ åŠŸèƒ½ä¼˜å…ˆçº§ï¼šé‡‡ç”¨ã€Œå‰ƒåˆ€åŸåˆ™ã€èšç„¦æ ¸å¿ƒåœºæ™¯ï¼Œé¦–æœŸä»…ä¿ç•™é—®ç­”/æ£€ç´¢/åŸºç¡€çˆ¬è™«åŠŸèƒ½</p>
</li>
<li>
<p>ğŸ§ª éªŒè¯é©±åŠ¨ï¼šTokenæœºåˆ¶å…ˆå®ç°ç®€å•ç§¯åˆ†å‘æ”¾ï¼ŒäºŒæœŸå†å¼•å…¥å…‘æ¢/æ¶ˆè´¹é—­ç¯</p>
</li>
<li>
<p>ğŸ“¶ æ¸è¿›æ¥å…¥ï¼šå¹³å°æ¥å…¥æŒ‰ã€Œå®˜ç½‘â†’å…¬ä¼—å·â†’æ ¡å›­é›†å¸‚â†’ç¤¾äº¤å¹³å°ã€é¡ºåºåˆ†é˜¶æ®µå®æ–½</p>
</li>
<li>
<p>ğŸš§ æ¶æ„æ¼”è¿›ï¼šä»å•ä½“â†’æ¨¡å—åŒ–â†’å¾®æœåŠ¡æ¸è¿›å¼æ”¹é€ ï¼Œé¿å…æ—©æœŸè¿‡åº¦è®¾è®¡</p>
</li>
</ol>
<h2 id="_4">ğŸ’» æŠ€æœ¯å®ç°</h2>
<h3 id="_5">é¡¹ç›®ç»“æ„æ ‘</h3>
<p>```plaintext
nkuwiki/
â”œâ”€â”€ core/               # æ ¸å¿ƒ
â”‚   â”œâ”€â”€ agent/         # Agentæ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ coze/          # Cozeå¹³å°é›†æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ coze_agent.py     # Agentå®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ coze_integration.py # APIé›†æˆ
â”‚   â”‚   â”‚   â””â”€â”€ coze_session.py   # ä¼šè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ agent.py          # AgentæŠ½è±¡åŸºç±»
â”‚   â”‚   â”œâ”€â”€ session_manager.py # å…¨å±€ä¼šè¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ agent_factory.py  # Agentå·¥å‚
â”‚   â”œâ”€â”€ bridge/          # è¿æ¥agentå’ŒæœåŠ¡çš„æ¡¥æ¢
â”‚   â”‚   â”œâ”€â”€ bridge.py  # æ¡¥æ¢
â”‚   â”‚   â”‚   â”œâ”€â”€ context.py # ä¸Šä¸‹æ–‡
â”‚   â”‚   â”‚   â”œâ”€â”€ reply.py # å›å¤
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ auth/          # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ duckdb_operator.py  # DuckDBæ“ä½œ
â”‚   â”‚   â””â”€â”€ redis_manager.py    # Redisè¿æ¥ç®¡ç†
â”‚   â””â”€â”€ utils/         # å…¬å…±å·¥å…·åº“
â”‚       â”œâ”€â”€ common/        # é€šç”¨å·¥å…·
â”‚       â”‚   â”œâ”€â”€ expired_dict.py  # å¸¦è¿‡æœŸå­—å…¸
â”‚       â”‚   â”œâ”€â”€ string_utils.py   # å­—ç¬¦ä¸²å¤„ç†
â”‚       â”‚   â”œâ”€â”€ const.py         # å¸¸é‡å®šä¹‰
â”‚       â”‚   â””â”€â”€ dequeue.py       # åŒç«¯é˜Ÿåˆ—å®ç°
â”‚       â”œâ”€â”€ plugins/       # æ’ä»¶ç³»ç»Ÿ
â”‚       â”‚   â”œâ”€â”€ plugin_manager.py # æ’ä»¶ç®¡ç†å™¨
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ translate/     # ç¿»è¯‘å·¥å…·
â”‚       â”‚   â”œâ”€â”€ factory.py # ç¿»è¯‘å·¥å‚
â”‚       â”‚   â””â”€â”€ ...
â”‚       â”œâ”€â”€ voice/         # è¯­éŸ³å·¥å…·
â”‚       â”‚   â”œâ”€â”€ factory.py # è¯­éŸ³å·¥å‚
â”‚       â”‚   â””â”€â”€ ...
â”‚       â””â”€â”€ anti_crawler/  # åçˆ¬å·¥å…·
â”‚           â”œâ”€â”€ factory.py # åçˆ¬å·¥å‚
â”‚           â””â”€â”€ ...
â”œâ”€â”€ etl/               # æ•°æ®é‡‡é›†å¤„ç†ç®¡é“
â”‚   â”œâ”€â”€ crawler/       # çˆ¬è™«ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ base_crawler.py  # çˆ¬è™«åŸºç±»
â”‚   â”‚   â”œâ”€â”€ wechat.py        # å¾®ä¿¡å…¬ä¼—å·çˆ¬è™«
â”‚   â”‚   â””â”€â”€ init_script.js   # åæ£€æµ‹è„šæœ¬
â”‚   â””â”€â”€ pipeline/      # æ•°æ®å¤„ç†ç®¡é“
â”‚       â”œâ”€â”€ data_export.py   # æ•°æ®å¯¼å‡º
â”‚       â””â”€â”€ merge_json.py    # æ•°æ®åˆå¹¶
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ terminal/      # ç»ˆç«¯æœåŠ¡
â”‚   â”œâ”€â”€ website/       # ç½‘ç«™æœåŠ¡
â”‚   â”œâ”€â”€ wechatmp/      # å¾®ä¿¡å…¬ä¼—å·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ wechatmp_channel.py  # ä¸»é€šé“é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ passive_reply.py    # è¢«åŠ¨å›å¤å¤„ç†
â”‚   â”‚   â”œâ”€â”€ active_reply.py     # ä¸»åŠ¨å›å¤å¤„ç†
â”‚   â”‚   â””â”€â”€ common.py          # å…¬å…±æ–¹æ³•
â”‚   â”œâ”€â”€ chat_channel.py     # é€šç”¨èŠå¤©é€šé“
â”‚   â”œâ”€â”€ chat_message.py     # èŠå¤©æ¶ˆæ¯å¤„ç†
â”‚   â””â”€â”€ channel_factory.py   # é€šé“ç®¡ç†
â””â”€â”€ infra/
    â”œâ”€â”€ deploy/        # éƒ¨ç½²é…ç½®
    â”‚   â””â”€â”€ scripts/    # éƒ¨ç½²è„šæœ¬
    â”‚       â”œâ”€â”€ start.sh     # å¯åŠ¨è„šæœ¬
    â”‚       â”œâ”€â”€ shutdown.sh # å…³é—­è„šæœ¬
    â”‚       â””â”€â”€ restart.sh  # é‡å¯è„šæœ¬
    â”œâ”€â”€ app.py           # ä¸»ç¨‹åº
    â””â”€â”€ monitoring/    # ç›‘æ§ä½“ç³»
        â”œâ”€â”€ loki/      # æ—¥å¿—ç®¡ç†
        â””â”€â”€ pyroscope/ # æŒç»­æ€§èƒ½åˆ†æ
â”œâ”€â”€ config.py  # å…¨å±€é…ç½®ç®¡ç†</p>
<p>/data/                  # æœåŠ¡å™¨æ ¹ç›®å½•ç‹¬ç«‹å­˜å‚¨
â”œâ”€â”€ raw/                # åŸå§‹æ•°æ®
â”‚   â”œâ”€â”€ website/        # ç½‘ç«™
â”‚   â”œâ”€â”€ wechat/         # å¾®ä¿¡å…¬ä¼—å·
â”‚   â”œâ”€â”€ campus_market/  # æ ¡å›­é›†å¸‚
â”‚   â”œâ”€â”€ xiaohongshu/    # å°çº¢ä¹¦
â”‚   â”œâ”€â”€ weibo/          # å¾®åš
â”‚   â”œâ”€â”€ douyin/         # æŠ–éŸ³
â”‚   â”œâ”€â”€ bilibili/       # Bç«™
â”‚   â”œâ”€â”€ zhihu/          # çŸ¥ä¹
â”‚   â”œâ”€â”€ volunteer/      # å¿—æ„¿è€…å›¢é˜Ÿè´¡çŒ®
â”‚   â”œâ”€â”€ user/           # ç”¨æˆ·è´¡çŒ®æ•°æ®
â””â”€â”€ processed/
    â”œâ”€â”€ structured/    # ç»“æ„åŒ–æ•°æ®ï¼ˆDuckDBï¼‰
    â””â”€â”€ vector/       # å‘é‡æ•°æ®ï¼ˆCozeåŒæ­¥ï¼‰</p>
<p>```text</p>
<h3 id="_6">æŠ€æœ¯é€‰å‹è¡¨</h3>
<table>
<thead>
<tr>
<th>æ¨¡å—</th>
<th>å­æ¨¡å—</th>
<th>æŠ€æœ¯æ ˆ</th>
<th>ç‰ˆæœ¬</th>
<th>é€‰å‹ä¾æ®</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>çˆ¬è™«å¼•æ“</strong></td>
<td>æ··åˆé‡‡é›†æ¶æ„</td>
<td>Playwright + Selenium</td>
<td>1.42.0 / 4.18.0</td>
<td>åŒå¼•æ“è¦†ç›–ç°ä»£SPAä¸ä¼ ç»Ÿç½‘é¡µåœºæ™¯ï¼ŒPlaywrightå¤„ç†å¤æ‚DOMæ€§èƒ½æå‡40%</td>
</tr>
<tr>
<td></td>
<td>åçˆ¬è§£å†³æ–¹æ¡ˆ</td>
<td>Browserless + mitmproxy</td>
<td>2.7.0 / 10.1.0</td>
<td>åˆ†å¸ƒå¼æµè§ˆå™¨æŒ‡çº¹æ··æ·† + å…¬ä¼—å·APIæµé‡é•œåƒæ•è·èƒ½åŠ›</td>
</tr>
<tr>
<td><strong>æ•°æ®æ¸…æ´—</strong></td>
<td>æ•°æ®æ¸…æ´—</td>
<td>Pandera + DuckDB</td>
<td>0.11.0 / 0.9.2</td>
<td>å£°æ˜å¼æ•°æ®éªŒè¯æ¡†æ¶ + åˆ—å¼å­˜å‚¨å®æ—¶å¤„ç†èƒ½åŠ›</td>
</tr>
<tr>
<td><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong></td>
<td>ç”¨æˆ·è´¡çŒ®å¤„ç†</td>
<td>RabbitMQ</td>
<td>3.13.0</td>
<td>æ”¯æŒAMQP 1.0åè®®ï¼Œæ¶ˆæ¯æŒä¹…åŒ–ä¸æ­»ä¿¡é˜Ÿåˆ—ä¿éšœæ•°æ®å®Œæ•´æ€§</td>
</tr>
</tbody>
</table>
<p>| <strong>å­˜å‚¨å±‚</strong>      | å¯¹è±¡å­˜å‚¨           | SeaweedFS                          | 3.64    | å¯¹è±¡å­˜å‚¨ä¸æ–‡ä»¶ç³»ç»Ÿç»Ÿä¸€æ¥å£ï¼Œè‡ªåŠ¨çº åˆ ç æœºåˆ¶ |
|                | å…ƒæ•°æ®å­˜å‚¨         | DuckDB                            | 0.9.2   | æ”¯æŒPythonåŸç”ŸOLAPæŸ¥è¯¢ï¼Œå‘é‡åŒ–æ‰§è¡Œå¼•æ“åŠ é€Ÿ |
| <strong>ä»»åŠ¡è°ƒåº¦</strong>    | åˆ†å¸ƒå¼ä»»åŠ¡         | Celery + Redis                     | 5.3.6 / 7.2.4 | æ”¯æŒä¼˜å…ˆçº§é˜Ÿåˆ—ä¸ä»»åŠ¡çŠ¶æ€è¿½è¸ªï¼ŒRedis Streamsä¿éšœæ¶ˆæ¯å¯é æ€§ |
| <strong>ç›‘æ§ä½“ç³»</strong>    | é“¾è·¯è¿½è¸ª          | OpenTelemetry                     | 1.24.0  | ç»Ÿä¸€è§‚æµ‹æ•°æ®æ ‡å‡†ï¼Œæ”¯æŒMetrics/Logs/Tracesä¸‰æ”¯æŸ± |
| <strong>æ ¸å¿ƒç»„ä»¶</strong>    | APIç½‘å…³           | Apache APISIX                     | 3.8.0   | åŠ¨æ€æ’ä»¶æ¶æ„æ”¯æŒJWTé‰´æƒ/é™æµ/ç†”æ–­ç­‰ç­–ç•¥çƒ­æ›´æ–° |</p>
<p>| <strong>Agentæ¨¡å—</strong>  | APIäº¤äº’å±‚         | FastAPI + HTTPX                    | 0.110.0 | å¼‚æ­¥HTTPå®¢æˆ·ç«¯æ”¯æŒSSE/WebSocketé•¿è¿æ¥ |
|                | å¤šæ¨¡æ€å¤„ç†        | Coze Multi-Modal API             | 2024.2  | æ”¯æŒæ–‡ç”Ÿå›¾/å›¾ç”Ÿæ–‡å¤šæ¨¡æ€è”åˆæ¨ç† |</p>
<p>| <strong>å¾®ä¿¡æœåŠ¡</strong>    | æ¶ˆæ¯è·¯ç”±          | FastAPI WebSocket                | 0.110.0 | æ”¯æŒä¸‡äººçº§å¹¶å‘æ¶ˆæ¯æ¨é€ï¼Œæ¶ˆæ¯å‹ç¼©ç‡60%+ |
|                | ä»»åŠ¡è°ƒåº¦          | Celery                           | 5.3.6   | æ”¯æŒå®šæ—¶ä»»åŠ¡ä¸å·¥ä½œæµç¼–æ’ï¼Œä»»åŠ¡å¤±è´¥è‡ªåŠ¨é‡è¯• |</p>
<p>| <strong>åŸºç¡€è®¾æ–½</strong>    | å®¹å™¨ç¼–æ’          | Docker Compose                   | 2.24.5  | æ”¯æŒæœåŠ¡ä¾èµ–ç®¡ç†ï¼Œå¼€å‘-ç”Ÿäº§ç¯å¢ƒä¸€è‡´æ€§ä¿éšœ |
|                | æ—¥å¿—ç®¡ç†          | Loki + Promtail                  | 2.9.4   | æ”¯æŒæ—¥å¿—æ ‡ç­¾åŒ–ç´¢å¼•ï¼Œå­˜å‚¨ç©ºé—´èŠ‚çœ70% |</p>
<h3 id="_7">æ ¸å¿ƒæ¨¡å—å®ç°</h3>
<h4 id="_8">çˆ¬è™«æ¶æ„å®ç°æ–¹æ¡ˆ</h4>
<p>```plantuml
@startuml
package "é‡‡é›†ç­–ç•¥è·¯ç”±" #LightBlue {
    component "åŠ¨æ€æ£€æµ‹" as dynamic_detection
    component "åçˆ¬åˆ†æ" as anti_spider
}</p>
<p>package "é‡‡é›†å¼•æ“" #LightGreen {
    component "Playwright" as playwright &lt;&lt;é›†ç¾¤&gt;&gt;
    component "Mitmproxy" as mitmproxy
}</p>
<p>component "Browserless" as browserless</p>
<p>dynamic_detection --&gt; playwright : "ç°ä»£Webåº”ç”¨"
dynamic_detection --&gt; mitmproxy : "å…¬ä¼—å·æµé‡æ•è·"</p>
<p>playwright --&gt; browserless : "æµè§ˆå™¨å®ä¾‹æ± "
@enduml</p>
<p>```text</p>
<p>æ–¹æ¡ˆè¯´æ˜</p>
<ol>
<li>
<p>playwright å¤„ç†ç°ä»£Webåº”ç”¨ï¼ˆBç«™/å°çº¢ä¹¦ï¼‰</p>
</li>
<li>
<p>mitmproxy æ•è·å…¬ä¼—å·æµé‡</p>
</li>
<li>
<p>browserless å®ç°IPè½®æ¢å’Œæµè§ˆå™¨æŒ‡çº¹æ··æ·†</p>
</li>
</ol>
<h4 id="_9">çŸ¥è¯†åº“å…¥åº“æµç¨‹</h4>
<p>```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml</p>
<p>' ==== çŸ¥è¯†åº“å…¥åº“æµç¨‹æ ‡é¢˜ ====
skinparam titleFontSize 18
title çŸ¥è¯†åº“å…¥åº“æµç¨‹\n<size:16>æ•°æ®è´¨é‡ä¿éšœä½“ç³»</size></p>
<p>skinparam defaultFontName "Microsoft YaHei"
skinparam defaultFontSize 14
skinparam linetype ortho
left to right direction</p>
<p>title çŸ¥è¯†åº“å…¥åº“æµç¨‹</p>
<p>' ==== ç³»ç»Ÿç»„ä»¶ ====
Container(etl, "ETLå¼•æ“", "Playwright+Selenium", "å¤šæºæ•°æ®é‡‡é›†")
Container(msg_broker, "æ¶ˆæ¯ä¸­æ¢", "RabbitMQ", "ä»»åŠ¡åˆ†å‘")
Container(quality_check, "è´¨é‡è¯„ä¼°", "Pandera", "æ•°æ®æ ¡éªŒ")
ContainerDb(knowledge_db, "çŸ¥è¯†åº“", "FAISS", "å‘é‡åŒ–å­˜å‚¨")
Container(volunteer_ui, "å¿—æ„¿è€…ç•Œé¢", "Web Admin", "äººå·¥å®¡æ ¸")</p>
<p>' ==== æ•°æ®æµ ====
Rel(etl, msg_broker, "åŸå§‹æ•°æ®æ¨é€", "AMQP")
Rel(msg_broker, quality_check, "å¾…å¤„ç†æ•°æ®", "AMQP")
Rel(quality_check, knowledge_db, "åˆæ ¼æ•°æ®å…¥åº“", "gRPC")
Rel(quality_check, volunteer_ui, "å¾…å®¡æ ¸æ•°æ®", "HTTP")
Rel(volunteer_ui, knowledge_db, "äººå·¥æ ¡å‡†æ•°æ®", "Admin API")</p>
<p>note right of quality_check
<color:#00796B><strong>è´¨é‡è¯„ä¼°æ ‡å‡†</strong></p>
<ol>
<li>
<p>ä¿¡æ¯å®Œæ•´æ€§</p>
</li>
<li>
<p>æ—¶æ•ˆæ€§éªŒè¯</p>
</li>
<li>
<p>æ¥æºå¯ä¿¡åº¦</p>
</li>
<li>
<p>é‡å¤æ€§æ£€æµ‹</p>
</li>
</ol>
<p>end note</p>
<p>note bottom of knowledge_db
<color:#D84315><strong>ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥</strong></p>
<ol>
<li>
<p>æ¯æ—¥å¢é‡æ›´æ–°</p>
</li>
<li>
<p>æ¯å‘¨å…¨é‡å¿«ç…§</p>
</li>
<li>
<p>å¿—æ„¿è€…å¯å›æ»šä»»æ„ç‰ˆæœ¬</p>
</li>
</ol>
<p>end note
@enduml</p>
<p>```text</p>
<h4 id="_10">ç”¨æˆ·è´¡çŒ®ç®¡é“</h4>
<p>```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml</p>
<p>skinparam defaultFontName "Microsoft YaHei"
skinparam defaultFontSize 14
skinparam wrapWidth 200
skinparam nodeFontSize 12
skinparam linetype ortho
left to right direction
' ==== ç³»ç»Ÿè¾¹ç•Œå®šä¹‰ ====
System_Boundary(user_layer, "ç”¨æˆ·ç«¯")  {
    Person(user, "ç”¨æˆ·", "æäº¤å­¦ä¹ èµ„æ–™", $sprite="person2", $tags="user")
    Container(wechat_mini, "å¾®ä¿¡å°ç¨‹åº", "å¾®ä¿¡ç”Ÿæ€æ¥å…¥", $tags="client")
    Container(web_upload, "Webä¸Šä¼ ", "ç½‘é¡µç«¯æœåŠ¡", $tags="client")
}</p>
<p>System_Boundary(access_layer, "æ¥å…¥å±‚") {
    Container(msg_queue, "æ¶ˆæ¯é˜Ÿåˆ—", "RabbitMQ", "å¼‚æ­¥ä»»åŠ¡å¤„ç†", $tags="mq")
    Container(auth_service, "é‰´æƒæœåŠ¡", "JWT", "èº«ä»½éªŒè¯ä¸æˆæƒ", $tags="auth")
    Container(preprocessor, "é¢„å¤„ç†å™¨", "Python", "æ•°æ®æ ‡å‡†åŒ–", $tags="processor")
}</p>
<p>System_Boundary(process_layer, "å¤„ç†å±‚") {
    ContainerDb(duckdb, "DuckDB", "ç»“æ„åŒ–å…ƒæ•°æ®", "åµŒå…¥å¼OLAPæ•°æ®åº“", $tags="core_db")
    Container(format_conv, "æ ¼å¼è½¬æ¢", "Pandoc", "ç»Ÿä¸€Markdownæ ¼å¼", $tags="processor")
    Container(quality_check, "è´¨é‡æ£€æµ‹", "Pandera", "æ•°æ®è´¨é‡æ ¡éªŒ", $tags="quality")
}</p>
<p>' ==== æ ·å¼å®šä¹‰ ====
AddElementTag("user_layer", $fontColor="#1E88E5", $borderColor="#64B5F6", $bgColor="#BBDEFB")
AddElementTag("access_layer", $fontColor="#43A047", $borderColor="#66BB6A", $bgColor="#C8E6C9")
AddElementTag("process_layer", $fontColor="#FB8C00", $borderColor="#FFA726", $bgColor="#FFE0B2")
AddElementTag("core_db", $fontColor="#BF360C", $borderColor="#D84315", $bgColor="#FFCCBC")</p>
<p>' ==== æ•°æ®æµå…³ç³» ====
Rel(user, wechat_mini, "æäº¤èµ„æ–™", "å¾®ä¿¡API")
Rel(wechat_mini, auth_service, "èº«ä»½è®¤è¯", "JWT")
Rel(auth_service, msg_queue, "æŠ•é€’ä»»åŠ¡", "AMQP")
Rel(msg_queue, preprocessor, "æ¶ˆè´¹ä»»åŠ¡", "AMQP")
Rel(preprocessor, format_conv, "æ ‡å‡†åŒ–å¤„ç†", "HTTP")
Rel(format_conv, quality_check, "æ ¼å¼æ ¡éªŒ", "HTTP")
Rel(quality_check, duckdb, "å­˜å‚¨å…ƒæ•°æ®", "DuckDB API")
Rel(quality_check, seaweedfs, "å­˜å‚¨æ–‡ä»¶", "SeaweedFS API")</p>
<p>note right of msg_queue
<color="#00796B><strong>æ¶ˆæ¯å¤„ç†è§„èŒƒ</strong></p>
<ol>
<li>
<p>æ¶ˆæ¯æŒä¹…åŒ–</p>
</li>
<li>
<p>è‡ªåŠ¨é‡è¯•æœºåˆ¶</p>
</li>
<li>
<p>ä¼˜å…ˆçº§é˜Ÿåˆ—</p>
</li>
</ol>
<p>end note</p>
<p>note left of duckdb
<color="#D84315><strong>å…ƒæ•°æ®è§„èŒƒ</strong></p>
<ol>
<li>
<p>æ–‡ä»¶å“ˆå¸Œå€¼</p>
</li>
<li>
<p>è´¡çŒ®è€…ä¿¡æ¯</p>
</li>
<li>
<p>æ—¶é—´æˆ³</p>
</li>
</ol>
<p>end note
@enduml</p>
<p>```text</p>
<h4 id="agent">agentäº¤äº’</h4>
<p>```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml</p>
<p>' ==== Agentäº¤äº’æ ‡é¢˜ ====
skinparam titleFontSize 18
title æ™ºèƒ½Agentäº¤äº’æ¶æ„\n<size:16>å¤šæ¨¡æ€ååŒå·¥ä½œæµ</size></p>
<p>skinparam defaultFontName "Microsoft YaHei"
skinparam defaultFontSize 14</p>
<p>title æ™ºèƒ½Agentäº¤äº’æ¶æ„</p>
<p>Component(ai_agent, "æ™ºèƒ½Agent", "Coze", "å¤šæ¨¡æ€å¤„ç†æ ¸å¿ƒ")
ComponentDb(knowledge_base, "çŸ¥è¯†åº“", "FAISS")
Component(plugin_mgr, "æ’ä»¶ç®¡ç†å™¨", "Python")
Component(user_interface, "ç”¨æˆ·ç•Œé¢", "å¤šå¹³å°ç»ˆç«¯")</p>
<p>' ==== æ•°æ®æµ ====
Rel(user_interface, ai_agent, "ç”¨æˆ·è¯·æ±‚", "HTTP/WebSocket")
Rel(ai_agent, knowledge_base, "RAGæ£€ç´¢", "gRPC")
Rel(ai_agent, plugin_mgr, "æ’ä»¶è°ƒç”¨", "Coze API")
Rel(plugin_mgr, user_interface, "æ’ä»¶å“åº”", "HTTP")
Rel(ai_agent, user_interface, "ç”Ÿæˆå“åº”", "SSE")</p>
<p>note right of ai_agent
<color:#673AB7><strong>å¤„ç†æµç¨‹</strong></p>
<ol>
<li>
<p>è§£æç”¨æˆ·æ„å›¾</p>
</li>
<li>
<p>RAGå¢å¼ºæ£€ç´¢</p>
</li>
<li>
<p>å¤šæ¨¡æ€å¤„ç†</p>
</li>
<li>
<p>æ’ä»¶ååŒå·¥ä½œ</p>
</li>
</ol>
<p>end note</p>
<p>note left of plugin_mgr
<color:#43A047><strong>æ’ä»¶ç±»å‹</strong></p>
<ul>
<li>
<p>æœç´¢å¼•æ“</p>
</li>
<li>
<p>åˆ›æ„ç”Ÿå›¾</p>
</li>
<li>
<p>æ•°æ®åˆ†æ</p>
</li>
<li>
<p>æ ¡å†æŸ¥è¯¢
end note
@enduml</p>
</li>
</ul>
<p>```text</p>
<h4 id="web">webæœåŠ¡</h4>
<p>```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml</p>
<p>' ==== WebæœåŠ¡æ ‡é¢˜ ====
skinparam titleFontSize 18
title WebæœåŠ¡æ¶æ„\n<size:16>é«˜å¯ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿ</size></p>
<p>skinparam defaultFontName "Microsoft YaHei"
skinparam defaultFontSize 14
skinparam linetype ortho</p>
<p>title WebæœåŠ¡æ¶æ„</p>
<p>Container(api_gateway, "APIç½‘å…³", "APISIX", "æµé‡æ§åˆ¶")
Container(web_service, "WebæœåŠ¡", "FastAPI", "ä¸šåŠ¡é€»è¾‘")
Container(task_worker, "Celery Worker", "åˆ†å¸ƒå¼ä»»åŠ¡")
ContainerDb(redis, "Redis", "ä»»åŠ¡é˜Ÿåˆ—")</p>
<p>' ==== æ•°æ®æµ ====
Rel_U(api_gateway, web_service, "è·¯ç”±è¯·æ±‚", "HTTP/2")
Rel(web_service, task_worker, "å¼‚æ­¥ä»»åŠ¡", "Redis")
Rel(task_worker, redis, "ä»»åŠ¡çŠ¶æ€å­˜å‚¨", "Redisåè®®")
Rel(web_service, redis, "ä¼šè¯ç¼“å­˜", "RESP")</p>
<p>note right of api_gateway
<color:#1E88E5><strong>ç½‘å…³åŠŸèƒ½</strong></p>
<ol>
<li>
<p>é™æµç†”æ–­</p>
</li>
<li>
<p>JWTéªŒè¯</p>
</li>
<li>
<p>è¯·æ±‚è·¯ç”±</p>
</li>
</ol>
<p>end note</p>
<p>note left of task_worker
<color:#D81B60><strong>ä»»åŠ¡ç±»å‹</strong></p>
<ul>
<li>
<p>æ–‡ä»¶å¤„ç†</p>
</li>
<li>
<p>æ•°æ®æ¸…æ´—</p>
</li>
<li>
<p>é€šçŸ¥å‘é€</p>
</li>
<li>
<p>å®šæ—¶ä»»åŠ¡
end note
@enduml</p>
</li>
</ul>
<p>```text</p>
<h3 id="_11">éƒ¨ç½²è§„èŒƒ</h3>
<p>Docker Composeé…ç½®</p>
<p>```yaml
version: '3.8'</p>
<p>services:
  apisix:
    image: apache/apisix:3.8.0-alpine
    ports:
      - "9080:9080"
      - "9180:9180"
    volumes:
      - ./apisix/config.yaml:/usr/local/apisix/conf/config.yaml
    networks:
      - nkuwiki-net
    depends_on:
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy</p>
<p>web:
    image: nkuwiki/web:v1.2
    env_file: .env
    networks:
      - nkuwiki-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3</p>
<p>celery_worker:
    image: nkuwiki/worker:v1.1
    env_file: .env
    command: celery -A services.wechat.celery_app worker --loglevel=info
    depends_on:
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy</p>
<p>redis:
    image: redis:7.2.4-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s</p>
<p>rabbitmq:
    image: rabbitmq:3.13.0-management-alpine
    environment:
      RABBITMQ_DEFAULT_USER: ${RABBITMQ_USER}
      RABBITMQ_DEFAULT_PASS: ${RABBITMQ_PASS}
    ports:
      - "5672:5672"
      - "15672:15672"
    volumes:
      - rabbitmq_data:/var/lib/rabbitmq
    healthcheck:
      test: ["CMD", "rabbitmq-diagnostics", "check_running"]
      interval: 30s</p>
<p>seaweedfs:
    image: chrislusf/seaweedfs:3.64
    ports:
      - "9333:9333"  # Master
      - "8080:8080"  # Volume
    command: "server -dir=/data"
    volumes:
      - seaweedfs_data:/data</p>
<p>otel_collector:
    image: otel/opentelemetry-collector-contrib:0.96.0
    volumes:
      - ./infrastructure/monitoring/otel-config.yaml:/etc/otelcol/config.yaml
    ports:
      - "4317:4317" # OTLP gRPC
      - "4318:4318" # OTLP HTTP</p>
<p>volumes:
  redis_data:
  rabbitmq_data:
  seaweedfs_data:</p>
<p>networks:
  nkuwiki-net:
    driver: bridge
    attachable: true</p>
<h1 id="_12">åå‘ä»£ç†é…ç½®ï¼ˆå¯é€‰ï¼‰</h1>
<h1 id="traefik">traefik:</h1>
<h1 id="image-traefikv211">image: traefik:v2.11</h1>
<h1 id="ports">ports:</h1>
<h1 id="-8080">- "80:80"</h1>
<h1 id="-443443">- "443:443"</h1>
<h1 id="volumes">volumes:</h1>
<h1 id="-varrundockersockvarrundockersockro">- /var/run/docker.sock:/var/run/docker.sock:ro</h1>
<p>```text</p>
<p>éƒ¨ç½²è¯´æ˜ï¼š</p>
<ol>
<li>
<p>ä½¿ç”¨<code>env_file</code>ç®¡ç†æ•æ„Ÿé…ç½®ï¼ˆéœ€åˆ›å»º.envæ–‡ä»¶ï¼‰</p>
</li>
<li>
<p>å¥åº·æ£€æŸ¥æœºåˆ¶ä¿éšœæœåŠ¡å¯åŠ¨é¡ºåº</p>
</li>
<li>
<p>ç‹¬ç«‹å­˜å‚¨å·å®ç°æ•°æ®æŒä¹…åŒ–</p>
</li>
<li>
<p>OpenTelemetry Collectorå®ç°ç»Ÿä¸€ç›‘æ§</p>
</li>
</ol>
<h2 id="_13">ğŸ“š æ–‡æ¡£ç»´æŠ¤</h2>
<table>
<thead>
<tr>
<th>ç‰ˆæœ¬</th>
<th>æ—¥æœŸ</th>
<th>ä¿®æ”¹äºº</th>
<th>å˜æ›´æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.0</td>
<td>2025-02-03</td>
<td>aokimi</td>
<td>åˆç¨¿</td>
</tr>
<tr>
<td>1.1</td>
<td>2025-02-05</td>
<td>aokimi</td>
<td>çˆ¬è™«æ¶æ„å…¨é¢è½¬å‘Playwright</td>
</tr>
</tbody>
</table>
      </div>
      <div class="theme-toggle" id="themeToggle">ğŸŒ“</div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const themeToggle = document.getElementById('themeToggle');
        
        themeToggle.addEventListener('click', function() {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('vuepress-theme-hope-scheme', newTheme);
        });
      });
    </script>
  </body>
</html>
