<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="Markdown" />
    <meta name="theme" content="VuePress Theme Hope" />
    <title>æ–‡æ¡£ | å—å¼€WIKI</title>
    <meta name="description" content="ç‚¹å‡»æ‰“å¼€aokimiçš„ä¸»é¡µ" />
    <style>
      :root {
        --vp-c-bg: #fff;
        --vp-c-text: #2c3e50;
        --vp-c-border: #eaecef;
        --vp-c-code-bg: #f6f8fa;
        --vp-c-brand: #3eaf7c;
        --vp-c-brand-light: #4abf8a;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
        --vp-c-text: #f0f0f0;
        --vp-c-border: #3e3e3e;
        --vp-c-code-bg: #282c34;
        --vp-c-brand: #3aa675;
        --vp-c-brand-light: #349469;
      }

      html, body {
        background: var(--vp-c-bg);
        color: var(--vp-c-text);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        line-height: 1.7;
      }

      .markdown-container {
        max-width: 960px;
        margin: 0 auto;
        padding: 2rem 2.5rem;
      }

      .markdown-content {
        background-color: var(--vp-c-bg);
        border-radius: 8px;
        padding: 2rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .markdown-content h1 {
        font-size: 2.2rem;
        border-bottom: 1px solid var(--vp-c-border);
        padding-bottom: 0.3rem;
        margin-top: 0;
      }

      .markdown-content h2 {
        font-size: 1.65rem;
        border-bottom: 1px solid var(--vp-c-border);
        padding-bottom: 0.3rem;
      }

      .markdown-content h3 {
        font-size: 1.35rem;
      }

      .markdown-content h4 {
        font-size: 1.15rem;
      }

      .markdown-content p {
        margin: 1rem 0;
      }

      .markdown-content blockquote {
        border-left: 4px solid var(--vp-c-brand);
        padding: 0.5rem 1rem;
        color: #6a737d;
        background-color: rgba(66, 185, 131, 0.1);
        margin: 1rem 0;
      }

      .markdown-content pre {
        background-color: var(--vp-c-code-bg);
        border-radius: 6px;
        padding: 1rem;
        overflow: auto;
      }

      .markdown-content code {
        font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
        padding: 0.2rem 0.4rem;
        background-color: var(--vp-c-code-bg);
        border-radius: 3px;
      }

      .markdown-content pre code {
        padding: 0;
        background-color: transparent;
      }

      .markdown-content table {
        border-collapse: collapse;
        width: 100%;
        margin: 1rem 0;
      }

      .markdown-content table th, .markdown-content table td {
        border: 1px solid var(--vp-c-border);
        padding: 0.6rem 1rem;
        text-align: left;
      }

      .markdown-content table th {
        background-color: rgba(0, 0, 0, 0.05);
      }

      .markdown-content img {
        max-width: 100%;
      }

      .markdown-content a {
        color: var(--vp-c-brand);
        text-decoration: none;
      }

      .markdown-content a:hover {
        text-decoration: underline;
        color: var(--vp-c-brand-light);
      }

      .markdown-content ul, .markdown-content ol {
        padding-left: 2rem;
      }

      .markdown-content li {
        margin: 0.5rem 0;
      }

      /* è¿”å›æŒ‰é’® */
      .back-button {
        display: inline-block;
        margin-bottom: 1rem;
        padding: 0.5rem 1rem;
        background-color: var(--vp-c-brand);
        color: white;
        border-radius: 4px;
        text-decoration: none;
        font-weight: 500;
      }

      .back-button:hover {
        background-color: var(--vp-c-brand-light);
      }

      /* æš—é»‘æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
      .theme-toggle {
        position: fixed;
        right: 1.5rem;
        bottom: 1.5rem;
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        background-color: var(--vp-c-brand);
        color: white;
        text-align: center;
        line-height: 3rem;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
  </head>
  <body>
    <div class="markdown-container">
      <a href="/docs.html" class="back-button">Â« è¿”å›æ–‡æ¡£åˆ—è¡¨</a>
      <div class="markdown-content">
        <p>å†™æ–‡ç« 
ç‚¹å‡»æ‰“å¼€aokimiçš„ä¸»é¡µ
5åƒå­—é•¿æ–‡ï¼šCOZEä¸“ä¸šç‰ˆAPIè°ƒç”¨è¶…è¯¦ç»†æ•™ç¨‹ï¼ˆPythonï¼‰
5åƒå­—é•¿æ–‡ï¼šCOZEä¸“ä¸šç‰ˆAPIè°ƒç”¨è¶…è¯¦ç»†æ•™ç¨‹ï¼ˆPythonï¼‰
DefinitelyFly
DefinitelyFly
â€‹å…³æ³¨
1 äººèµåŒäº†è¯¥æ–‡ç« 
éšç€å­—èŠ‚åœ¨å¤§æ¨¡å‹å†›å¤‡ç«èµ›ä¸­ä¸€éª‘ç»å°˜ï¼Œè¶Šæ¥è¶Šå¤šçš„å°ä¼™ä¼´å¼€å§‹æ³¨æ„åˆ°æ‰£å­ï¼ˆCOZEï¼‰è¿™ä¸ªå¼ºå¤§çš„æ™ºèƒ½ä½“å·¥ä½œæµæ­å»ºå¹³å°ã€‚ç„¶è€Œï¼Œä¸å¾—ä¸è¯´ï¼Œæ‰£å­çš„å®˜æ–¹æ•™ç¨‹å®åœ¨æ˜¯å‡ºäº†åçš„è‰ç‡ï¼Œæ—¢æ²¡æœ‰ç¤ºä¾‹ä»£ç ï¼Œæ’ç‰ˆå¸ƒå±€ä¹Ÿååˆ†æ··ä¹±ï¼Œæ‰£å­åŸºç¡€ç‰ˆã€æ‰£å­ä¸“ä¸šç‰ˆã€è±†åŒ…å¤§æ¨¡å‹ã€ç«å±±å¼•æ“ã€ç«å±±æ–¹èˆŸè®©äººå‚»å‚»åˆ†ä¸æ¸…æ¥šï¼Œæ··ä¹±ç¨‹åº¦ç®€ç›´ä»¤äººå’‹èˆŒã€‚</p>
<p>æœ¬æ–‡å°†æä¾›å®˜æ–¹æ–‡æ¡£æ²¡æœ‰æä¾›çš„è°ƒç”¨ COZE BOT API çš„ Python ä»£ç ï¼Œå…³äºè±†åŒ…å¤§æ¨¡å‹çš„è°ƒç”¨å°†åœ¨å¦ä¸€ç¯‡ä¸­è¯¦è¿°ã€‚</p>
<p>ä¸€ã€åŸºç¡€çŸ¥è¯†
é¦–å…ˆï¼Œæ‰£å­åˆ†ä¸ºå›½å†…ç‰ˆå’Œæµ·å¤–ç‰ˆï¼Œå¯ä»¥è°ƒç”¨åŸºç¡€æ¨¡å‹ä¸ä¸€æ ·ï¼Œæ¯”å¦‚æµ·å¤–ç‰ˆå¯ä»¥è°ƒç”¨Chat-GPTï¼Œä½†å›½å†…ç‰ˆä¸è¡Œã€‚ä¸è¿‡ï¼Œæµ·å¤–ç‰ˆéœ€è¦ç”¨åˆ°æ¢¯å­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å…ˆä»¥å›½å†…ç‰ˆä¸ºä¾‹ï¼Œå›½å†…ç‰ˆçš„å®˜ç½‘æ˜¯è¿™ä¸ªï¼š</p>
<p>æ‰£å­-AI æ™ºèƒ½ä½“å¼€å‘å¹³å°
â€‹www.coze.cn/
å›½å†…ç‰ˆåˆåˆ†ä¸ºåŸºç¡€ç‰ˆå’Œä¸“ä¸šç‰ˆï¼ˆå›½å¤–ç‰ˆå¥½åƒæ˜¯ä¸åˆ†çš„ï¼‰ï¼Œä¸“ä¸šç‰ˆå’ŒåŸºç¡€ç‰ˆç™»å½•çš„å…¥å£æ˜¯ä¸åŒçš„ï¼Œè€Œä¸”ä½ åŒä¸€ä¸ªè´¦å·ä¸‹çš„ä¸“ä¸šç‰ˆå’ŒåŸºç¡€ç‰ˆæ˜¯ä¸äº’é€šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åœ¨åŸºç¡€ç‰ˆé‡Œåˆ›å»ºçš„æ™ºèƒ½ä½“ï¼Œä¸ä¼šè‡ªåŠ¨å‡ºç°åœ¨ä¸“ä¸šç‰ˆçš„è´¦å·é‡Œï¼Œè™½ç„¶å¯ä»¥è¿›è¡Œè¿ç§»ï¼Œä½†åªèƒ½è¿ç§»ä¸€æ¬¡ï¼Œè¿™ç‚¹æ˜¯æœ€ç¥å¥‡çš„ã€‚</p>
<p>ä¸“ä¸šç‰ˆå’ŒåŸºç¡€ç‰ˆåœ¨APIè°ƒç”¨é™åˆ¶ä¸Šçš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<p>åŸºç¡€ç‰ˆ ä¸“ä¸šç‰ˆ
COZEå›½å†…ç‰ˆAPI  2024å¹´8æœˆ15æ—¥ä¹‹åï¼Œæ‰£å­ API çš„å…è´¹é¢åº¦ä¸ºæ¯ä¸ªè´¦å· 100 æ¬¡ API è°ƒç”¨ã€‚ä¸€æ—¦ç´¯è®¡è°ƒç”¨æ¬¡æ•°è¶…è¿‡å…è´¹é¢åº¦ï¼Œæ­¤è´¦å·å°†æ— æ³•ç»§ç»­ä½¿ç”¨ä»»ä½•æ‰£å­ APIã€‚
API å…è´¹é¢åº¦ä¸é€‚ç”¨äºé€šè¿‡æ‰£å­å¹³å°ã€å…¶ä»–å‘å¸ƒæ¸ é“æˆ– SDK äº§ç”Ÿçš„è¯·æ±‚ã€‚   ä¸é™åˆ¶ API è°ƒç”¨æ¬¡æ•°ã€‚
è°ƒç”¨å‘èµ·å¯¹è¯ã€æ‰§è¡Œå·¥ä½œæµæˆ–æ‰§è¡Œå·¥ä½œæµï¼ˆæµå¼å“åº”ï¼‰APIï¼Œæ ¹æ® Bot è°ƒç”¨æ¬¡æ•°å’Œæ–¹èˆŸæ¨¡å‹ Token æ¶ˆè€—æ”¶å–è´¹ç”¨ï¼›è°ƒç”¨æ¢å¤è¿è¡Œå·¥ä½œæµï¼Œä»…æ ¹æ®æ–¹èˆŸæ¨¡å‹ Token æ¶ˆè€—æ”¶å–è´¹ç”¨ï¼›è°ƒç”¨å…¶ä»–æ¥å£å…è´¹ã€‚
æ€»ç»“èµ·æ¥å°±æ˜¯ï¼Œå…è´¹ç‰ˆæœ‰è°ƒç”¨æ¬¡æ•°é™åˆ¶ï¼Œä¸”æ€»å…±åªæœ‰100æ¬¡ã€‚æ‰€ä»¥å¦‚æœ100æ¬¡ä¸å¤Ÿç”¨çš„å°ä¼™ä¼´ï¼Œå°±åªèƒ½é€‰æ‹©ä¸“ä¸šç‰ˆäº†ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¸“ä¸šç‰ˆæ¯æ¬¡è°ƒç”¨çš„æ”¶è´¹åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<p>botè°ƒç”¨æ¬¡æ•°ï¼Œå°±æ˜¯è°ƒç”¨ä¸€æ¬¡æ™ºèƒ½ä½“æ”¶ä¸€æ¬¡è´¹ï¼›
æ™ºèƒ½ä½“æ¶ˆè€—çš„tokenæ•°ï¼Œå°±æ˜¯çœ‹ä½ æ™ºèƒ½ä½“é‡Œç”¨åˆ°çš„å¤§è¯­è¨€æ¨¡å‹æ¶ˆè€—çš„tokenï¼Œè¿™ä¸€ç‚¹å’Œå•ç‹¬è°ƒç”¨è±†åŒ…ä¸€æ ·ï¼›
ä¸è¿‡ï¼Œè™½ç„¶æ˜¯ä¸¤é“æ”¶è´¹ï¼Œä½†å…¶å®ä¹Ÿä¸è´µã€‚é¦–å…ˆï¼Œå­—èŠ‚çš„å¤§æ¨¡å‹tokenæ”¶è´¹å¯ä»¥è¯´æ˜¯å›½å†…æ‰€æœ‰å¤§æ¨¡å‹é‡Œçš„åœ°æ¿ä»·äº†ï¼Œæ¯”é‚£äº›å°å‚çš„ç”šè‡³å¯ä»¥ä½2ä¸ªæ•°é‡çº§ï¼›å…¶æ¬¡ï¼Œæ™ºèƒ½ä½“è°ƒç”¨æ”¶è´¹å¥½åƒæ˜¯è°ƒç”¨ä¸€æ¬¡æ‰£2ç‚¹ï¼Œä½†ç°åœ¨æœ‰ä¼˜æƒ ï¼Œ50ä¸‡ç‚¹1å—é’±ï¼Œæ‰€ä»¥è¿™ä¸ªè´¹ç”¨ä¹Ÿå°±å¿½ç•¥ä¸è®¡äº†ã€‚</p>
<p>äºŒã€åˆ›å»ºæ™ºèƒ½ä½“
æœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®²å¦‚ä½•é€šè¿‡APIæ¥è°ƒç”¨ä½ å·²ç»åˆ›å»ºå¥½çš„æ™ºèƒ½ä½“ï¼Œæ‰€ä»¥åˆ›å»ºæ™ºèƒ½ä½“çš„éƒ¨åˆ†å°±ä¸å†èµ˜è¿°å•¦ï¼Œç½‘ä¸Šæ•™ç¨‹ä¹Ÿè¶Šæ¥è¶Šå¤šï¼ŒCOZEåœ¨Bç«™ä¹Ÿæœ‰å®˜æ–¹æ•™ç¨‹ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š</p>
<p>æ‰£å­Cozeä¸ªäººä¸»é¡µ
â€‹space.bilibili.com/1444391473
æ³¨æ„ï¼Œè®°å¾—åœ¨ä¸“ä¸šç‰ˆé‡Œåˆ›å»ºï¼Œå› ä¸ºåŸºç¡€ç‰ˆé‡Œåˆ›å»ºçš„è¯ä½ åªæœ‰100æ¬¡çš„APIè°ƒç”¨æœºä¼šã€‚</p>
<p>ä¸“ä¸šç‰ˆé‡Œçš„æ™ºèƒ½ä½“è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹éœ€è¦ä½ åˆ›å»ºæ¥å…¥ç‚¹ï¼Œè¿™ä¸ªæˆ‘ä¼šå¦å¤–å‡ºä¸€ä¸ªæ•™ç¨‹ã€‚</p>
<p>ä¸‰ã€è°ƒç”¨çš„å‰ç½®å‡†å¤‡
åœ¨è°ƒç”¨COZEçš„APIä¹‹å‰ï¼Œç¡®ä¿ä½ å®Œæˆäº†ä»¥ä¸‹ä¸¤ä»¶äº‹ï¼š</p>
<p>å‘å¸ƒ Bot ä¸º API æœåŠ¡ï¼Œå‘å¸ƒ Bot æ—¶ä¸€å®šè¦å‹¾é€‰â€œBot as APIâ€ï¼›
è·å–è®¿é—®ä»¤ç‰Œï¼Œè¿™ä¸ªåœ¨è°ƒç”¨APIæ—¶éœ€è¦ç”¨åˆ°ï¼›
å…·ä½“å¯ä»¥å‚è€ƒè¿™ä¸ªå®˜æ–¹æ–‡æ¡£ï¼š</p>
<p>æ‰£å­ - å¼€å‘æŒ‡å— - å‡†å¤‡å·¥ä½œ
â€‹www.coze.cn/docs/developer_guides/preparation
å››ã€ç”¨Pythonè°ƒç”¨Bot API
å¥½ï¼Œé‡å¤´æˆæ¥äº†ã€‚</p>
<p>è™½ç„¶æ‰£å­çš„å®˜æ–¹æ–‡æ¡£å†™çš„ä¸å’‹åœ°ï¼Œä½†æˆ‘è¿˜æ˜¯ç¤¼è²Œæ€§åœ°æä¾›ä¸€ä¸‹ï¼Œæ¯•ç«Ÿå…ˆçœ‹å®˜æ–¹æ–‡æ¡£æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼š</p>
<p>æ‰£å­ - å¼€å‘æŒ‡å—
â€‹www.coze.cn/docs/developer_guides/coze_api_overview
ï¼ˆä¸€ï¼‰å¯¼å…¥å¿…è¦çš„åº“
import re
import requests
import json
import time
import sys
è¿™å‡ ä¸ªæ˜¯åŸºç¡€çš„ï¼Œå½“ç„¶å¯èƒ½è¿˜æœ‰å…¶ä»–çš„ï¼Œæ ¹æ®ä½ çš„éœ€æ±‚æ¥ã€‚</p>
<p>ï¼ˆäºŒï¼‰å‡†å¤‡IDä¿¡æ¯
bot_id = "ä½ çš„BOT-ID"
access_token = 'Bearer pat_ä½ çš„è®¿é—®ä»¤ç‰Œ'
user_id = "ä½ çš„USER-ID"
å¦‚ä½•è·å–bot_idå’Œuser_idï¼šæ‰“å¼€ä½ çš„æ™ºèƒ½ä½“ç¼–è¾‘ç•Œé¢ï¼Œç½‘å€çš„ç»“æ„åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<p>https://www.coze.cn/space/"ä½ çš„USER-ID"/bot/"ä½ çš„BOT-ID"
å¦‚ä½•è·å–access_tokenï¼šè¯·å‚è€ƒä¸Šè¿°â€œä¸‰ã€è°ƒç”¨çš„å‰ç½®å‡†å¤‡â€ï¼Œè¯·æ³¨æ„ï¼Œä»¤ç‰Œä»…åœ¨ç”Ÿæˆæ—¶å±•ç¤ºä¸€æ¬¡ï¼Œè¯·å³åˆ»å¤åˆ¶å¹¶ä¿å­˜ã€‚å¦å¤–ï¼Œè®¾ç½®access_token æ—¶ä¸è¦å¿˜è®°åŠ ä¸Šâ€œBearer pat_â€çš„å‰ç¼€ã€‚</p>
<p>ï¼ˆä¸‰ï¼‰æ„å»ºè¯·æ±‚
api_url = 'https://api.coze.cn/v3/chat'
headers = {
    'Authorization': access_token,
    'Content-Type': 'application/json'
}  <br />
body = {
    "bot_id": bot_id,<br />
    "user_id": user_id,<br />
    "stream": True,
    "auto_save_history": not(True),
    "additional_messages": messages
}
response = requests.post(api_url, headers=headers, json=body)</p>
<h1 id="printresponse">print(response)</h1>
<p>è¿™é‡Œè¦æ³¨æ„ï¼Œstreamä¸ºTrueæ—¶ï¼Œauto_save_historyåªèƒ½ä¸ºFalseï¼›streamä¸ºFalseæ—¶ï¼Œauto_save_historyåªèƒ½ä¸ºTrueï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>messageså°±æ˜¯å¸¸è§„æ ¼å¼ï¼Œæ¯”å¦‚ï¼š</p>
<p>messages = [
            {"role": "system", "content": "ä½ æ˜¯æ™ºèƒ½åŠ©æ‰‹",},
            {"role": "user", "content": "è¯·å›ç­”æˆ‘çš„é—®é¢˜",},
        ]
ï¼ˆå››ï¼‰æµå¼è¾“å‡º
è¿™é‡Œè®²æµå¼è¾“å‡ºï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹æµå¼è¾“å‡ºçš„ç»“æ„ï¼š</p>
<p>æ‰£å­ - å¼€å‘æŒ‡å— - æµå¼è¾“å‡ºç»“æ„
â€‹www.coze.cn/docs/developer_guides/get_chat_response
æµå¼è¾“å‡ºçš„æœ‰æ•ˆå­—æ®µæ˜¯åœ¨ event ='conversation.message.delta' çš„å‰æä¸‹ï¼Œdata è¿”å›å€¼ä¸­çš„"content"ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<p>for line in response.iter_lines():
    decoded_line = line.decode('utf-8',errors='ignore')   #è§£ç 
    #print(decoded_line)
    if decoded_line.startswith("event:"):   #æ ‡è®°event
        event = decoded_line[6:]
        #print(event)
    if decoded_line.startswith("data:"):
        event_data = json.loads(decoded_line[5:])
        #print(event_data)
        if event == 'conversation.message.delta':   #æµå¼è¾“å‡ºæ ‡è®° <br />
            sys.stdout.write(event_data["content"])
            time.sleep(0.1)
æµå¼è¾“å‡ºæœ‰ä¸ªå‰æï¼Œå°±æ˜¯ä½ çš„æ™ºèƒ½ä½“æœ€åä¸€æ­¥æ˜¯å¤§è¯­è¨€æ¨¡å‹çš„è¾“å‡ºï¼Œæˆ–è€…ä½ çš„æ™ºèƒ½ä½“æœ‰æ¶ˆæ¯æ¨¡å—æ¥å±•ç¤ºå¤§è¯­è¨€æ¨¡å‹çš„æµå¼è¾“å‡ºç»“æœã€‚å‡å¦‚ä½ çš„æ™ºèƒ½ä½“æœ¬èº«å°±æ— æ³•å°†ç»“æœæµå¼è¾“å‡ºï¼Œé‚£ä¹ˆé€šè¿‡APIä¹Ÿæ˜¯æ— æ³•åŠåˆ°çš„ã€‚å…·ä½“çš„ä½ å¯ä»¥åœ¨è‡ªå·±çš„æ™ºèƒ½ä½“ç¼–è¾‘é¡µé¢å°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯èƒ½å¤Ÿæµå¼è¾“å‡ºã€‚</p>
<p>ï¼ˆäº”ï¼‰éæµå¼è¾“å‡º
éæµå¼è¾“å‡ºåè€Œæ›´å¤æ‚ä¸€äº›ã€‚</p>
<p>ä½ è¦è®¾ç½® stream = falseï¼Œauto_save_history=trueï¼Œè¡¨ç¤ºä½¿ç”¨éæµå¼å“åº”ï¼Œå¹¶è®°å½•å†å²æ¶ˆæ¯ã€‚
ä½ éœ€è¦è®°å½•ä¼šè¯çš„ Conversation ID å’Œ Chat IDï¼Œç”¨äºåç»­æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚
å®šæœŸè½®è¯¢æŸ¥çœ‹å¯¹è¯è¯¦æƒ…æ¥å£ï¼Œå»ºè®®æ¯æ¬¡é—´éš” 1 ç§’ä»¥ä¸Šï¼Œç›´åˆ°ä¼šè¯çŠ¶æ€æµè½¬ä¸ºç»ˆæ€ï¼Œå³ status ä¸º completed æˆ– required_actionã€‚
è°ƒç”¨æŸ¥çœ‹å¯¹è¯æ¶ˆæ¯è¯¦æƒ…æ¥å£ï¼ŒæŸ¥è¯¢æ¨¡å‹ç”Ÿæˆçš„æœ€ç»ˆç»“æœã€‚
å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<p>response = response.json()</p>
<h1 id="printresponse_1">print(response)</h1>
<p>conversation_id = response['data'].get('conversation_id')
chat_id = response['data'].get('id')
print(f'Chat_ID:{conversation_id};\nConversation_ID:{conversation_id}')</p>
<p>retrieve_url = f'https://api.coze.cn/v3/chat/retrieve?conversation_id={conversation_id}&amp;chat_id={chat_id}'
while requests.get(retrieve_url, headers=headers).json()['data']['status'] != "completed":
    time.sleep(0.5)
    print("coze bot wait ......")</p>
<p>message_url = f'https://api.coze.cn/v3/chat/message/list?chat_id={chat_id}&amp;conversation_id={conversation_id}'
message_response = requests.get(message_url, headers=headers).json()
event_data_answer = message_response['data'][1]
output = event_data_answer["content"]
print(output)
è‡³æ­¤ï¼ŒCOZEä¸“ä¸šç‰ˆAPIè°ƒç”¨çš„æ ¸å¿ƒéƒ¨åˆ†å°±è®²å®Œå•¦ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ã€‚</p>
<p>ï¼ˆå…­ï¼‰çŸ¥è¯†åº“å¬å›ç»“æœ
å¦‚æœä½ çš„æ™ºèƒ½ä½“é‡Œé¢æœ‰ç”¨åˆ°çŸ¥è¯†åº“ï¼Œé‚£ä¹ˆ Coze Bot çš„è¿”å›ç»“æœé‡Œæ˜¯æœ‰çŸ¥è¯†åº“çš„RAGå¬å›ç»“æœçš„ï¼Œç”šè‡³è¿˜æœ‰å¬å›å†…å®¹æ‰€åœ¨çŸ¥è¯†åº“çš„é¡µé¢linkï¼Œå¦‚æœä½ éœ€è¦çš„è¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼è°ƒç”¨ï¼š</p>
<p>çŸ¥è¯†åº“çš„å¬å›å†…å®¹æ˜¯åœ¨ event = 'conversation.message.completed' æ—¶ï¼ˆæµå¼è¾“å‡ºï¼‰ä¸” event_data['type'] = 'verbose' æ—¶ï¼Œevent_data_content["msg_type"] = "knowledge_recall" ä¸‹çš„å†…å®¹ï¼Œå…·ä½“åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºå¦‚ä¸‹å‡½æ•°æ¥è§£æå“åº”çš„å†…å®¹ï¼š</p>
<p>def get_coze_rag(event_data):</p>
<div class="codehilite"><pre><span></span><code><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">()</span>

<span class="k">if</span><span class="w"> </span><span class="n">event_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;verbose&#39;</span><span class="p">:</span>

<span class="w">    </span><span class="n">event_data_content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">event_data</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
<span class="w">    </span><span class="c1">#print(json.dumps(event_data_content, indent=4,ensure_ascii=False))</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">event_data_content</span><span class="p">[</span><span class="s2">&quot;msg_type&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;knowledge_recall&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="n">event_data_content_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">event_data_content</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
<span class="w">        </span><span class="c1">#print(json.dumps(event_data_content_data, indent=4,ensure_ascii=False))</span>

<span class="w">        </span><span class="n">event_chunks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event_data_content_data</span><span class="p">[</span><span class="s1">&#39;chunks&#39;</span><span class="p">]</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">event_chunk</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">event_chunks</span><span class="p">:</span>
<span class="w">            </span><span class="n">knowledge_slice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event_chunk</span><span class="p">[</span><span class="s1">&#39;slice&#39;</span><span class="p">]</span>
<span class="w">            </span><span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">knowledge_slice</span><span class="p">)</span>
<span class="w">            </span><span class="n">knowledge_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event_chunk</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">][</span><span class="s1">&#39;link&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;u0026&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">knowledge_url</span><span class="p">)</span>

<span class="k">return</span><span class="w"> </span><span class="n">result</span>
</code></pre></div>

<p>è¿™ä¸ªå‡½æ•°çš„è¾“å…¥æ˜¯å“åº”æµevent_dataï¼Œè¾“å‡ºçš„resultä¸ºç”±å¬å›ç‰‡æ®µå’Œå¬å›ç‰‡æ®µæ‰€åœ¨çš„çŸ¥è¯†åº“é¡µé¢linkç»„æˆçš„listã€‚</p>
<p>ç”±æ­¤ï¼Œå¯¹äºæµå¼è¾“å‡ºï¼Œæˆ‘ä»¬çš„æ”¹å†™å¦‚ä¸‹ï¼š</p>
<p>knowledge_results = []</p>
<p>for line in response.iter_lines():
    decoded_line = line.decode('utf-8',errors='ignore')   #è§£ç 
    #print(decoded_line)
    if decoded_line.startswith("event:"):   #æ ‡è®°event
        event = decoded_line[6:]
        #print(event)
    if decoded_line.startswith("data:"):
        event_data = json.loads(decoded_line[5:])
        #print(event_data)
        if event == 'conversation.message.delta':   #æµå¼è¾“å‡ºæ ‡è®° <br />
            sys.stdout.write(event_data["content"])
            time.sleep(0.1)
        if event == 'conversation.message.completed':   #çŸ¥è¯†åº“ã€æœ€ç»ˆå®Œæ•´è¾“å‡ºæ ‡è®°
            knowledge_results = knowledge_results + get_coze_rag(event_data)</p>
<p>print(f"\n\nçŸ¥è¯†åº“å¬å›ç‰‡æ®µï¼š{knowledge_results}")
å¯¹äºéæµå¼è¾“å‡ºï¼Œæˆ‘ä»¬çš„æ”¹å†™å¦‚ä¸‹ï¼š</p>
<p>response = response.json()</p>
<h1 id="printresponse_2">print(response)</h1>
<p>conversation_id = response['data'].get('conversation_id')
chat_id = response['data'].get('id')
print(f'Chat_ID:{conversation_id};\nConversation_ID:{conversation_id}')</p>
<p>retrieve_url = f'https://api.coze.cn/v3/chat/retrieve?conversation_id={conversation_id}&amp;chat_id={chat_id}'
while requests.get(retrieve_url, headers=headers).json()['data']['status'] != "completed":
    time.sleep(0.5)
    print("coze bot wait ......")</p>
<p>message_url = f'https://api.coze.cn/v3/chat/message/list?chat_id={chat_id}&amp;conversation_id={conversation_id}'
message_response = requests.get(message_url, headers=headers).json()</p>
<p>event_data_knowledge = message_response['data'][0]
knowledge_results = get_coze_rag(event_data_knowledge)</p>
<p>event_data_answer = message_response['data'][1]
output = event_data_answer["content"]</p>
<p>print(output)
print(f"\nçŸ¥è¯†åº“å¬å›ç‰‡æ®µï¼š{knowledge_results}")
ä¸Šé¢æ‰€æœ‰ä»£ç å‡å®æµ‹å¯ç”¨æ— æŠ¥é”™ï¼Œä½†ä¹Ÿå‡é¢„ç•™äº†printè°ƒè¯•æ¥å£ï¼Œä»¥ä¾›é‡åˆ°bugæ—¶è°ƒè¯•ã€‚å½“ç„¶ï¼ŒæŠ¥é”™æ—¶æ±‚åŠ©å¤§æ¨¡å‹ä¹Ÿæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼ˆæ¨èDeepSeekï¼‰ã€‚</p>
<p>ç¼–è¾‘äº 2024-10-15 20:51ãƒ»IP å±åœ°ä¸Šæµ·
Python
API
cozeä¸“ä¸šç‰ˆ
â€‹èµåŒ 1â€‹
â€‹2 æ¡è¯„è®º
â€‹åˆ†äº«
â€‹å–œæ¬¢
â€‹æ”¶è—
â€‹ç”³è¯·è½¬è½½
â€‹</p>
<p>èµåŒ 1</p>
<p>â€‹
åˆ†äº«</p>
<p>ç†æ€§å‘è¨€ï¼Œå‹å–„äº’åŠ¨</p>
<p>2 æ¡è¯„è®º
é»˜è®¤
æœ€æ–°
ç™½ç¬‘çŒ«
ç™½ç¬‘çŒ«
å¯ä»¥å‡ºä¸ªå·¥ä½œæµAPIè°ƒç”¨å—è°¢è°¢[çˆ±]</p>
<p>02-21 Â· å¹¿ä¸œ
â€‹å›å¤
â€‹1
DefinitelyFly
DefinitelyFly
ä½œè€…
æˆ‘æ‰¾äº†ä¸€ä¸‹ COZEå¥½åƒä¸æ”¯æŒç›´æ¥è°ƒç”¨å·¥ä½œæµå“ˆ å¿…é¡»åŒ…è£…ä¸ºæ™ºèƒ½ä½“æˆ–è€…åº”ç”¨åæ‰èƒ½å‘å¸ƒAPI</p>
<p>03-10 Â· ä¸Šæµ·
â€‹å›å¤
â€‹å–œæ¬¢
æ¨èé˜…è¯»
åŸºäºcozeåˆ›å»ºè‡ªå·±çš„ç§äººçŸ¥è¯†åº“
corzæ˜¯å­—èŠ‚è·³åŠ¨å‘å¸ƒçš„â€œä¸€ç«™å¼AIå¼€å‘å¹³å°â€œï¼Œçœ‹å®˜æ–¹ä»‹ç»ä¸ºï¼š Coze is a next-generation AI Bot development platform. Regardless of your programming experience, Coze enables you to eâ€¦</p>
<p>Ryan
äººäººéƒ½å­¦å¾—ä¼šç”¨cozeå·¥ä½œæµæ­å»º|ä¿å§†çº§å·¥ä½œæµæ•™ç¨‹
ä¹‹å‰æˆ‘ä»¬å†™äº†ä¸€ç¯‡è¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡cozeæ­å»ºbotï¼ˆæœºå™¨äººï¼‰çš„è¯¦ç»†æ•™ç¨‹ã€‚ 100%å…è´¹ç”¨GPT4 Turboï¼Cozeï¼ˆæ‰£å­ï¼‰å¹³å°ä¿å§†çº§åˆ›å»ºbotï¼ˆæ™ºèƒ½ä½“ï¼‰æ•™ç¨‹è¿™ç¯‡é˜…è¯»é‡è¿˜ä¸é”™ï¼Œä»Šå¤©æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹æ¯”è¾ƒéš¾çš„ â€¦</p>
<p>å°å´ç§‘æŠ€å±‹
åƒäº¿å‚æ•°ï¼Œç™¾ä¸‡åºåˆ— | XTuner è¶…é•¿ä¸Šä¸‹æ–‡è®­ç»ƒæ–¹æ¡ˆ
åƒäº¿å‚æ•°ï¼Œç™¾ä¸‡åºåˆ— | XTuner è¶…é•¿ä¸Šä¸‹æ–‡è®­ç»ƒæ–¹æ¡ˆ
OpenMMLab
cozeæ•™ç¨‹ | 04 å·¥ä½œæµä¹‹å¤§æ¨¡å‹èŠ‚ç‚¹
1 å¤§æ¨¡å‹èŠ‚ç‚¹æ¦‚è¿°é¦–å…ˆçœ‹ä¸€ä¸‹å¤§æ¨¡å‹èŠ‚ç‚¹çš„é…ç½®ï¼š é…ç½®å¯ä»¥çœ‹åˆ°5ä¸ªéƒ¨åˆ†ï¼š 1.1 æ¨¡å‹è¿™æ¬¡ä»‹ç»çš„æ˜¯cozeå›½å†…ç‰ˆï¼Œå¦‚æœæ˜¯æµ·å¤–ç‰ˆçš„è¯æ¨¡å‹çš„é€‰æ‹©æ˜¯ä¸ä¸€æ ·çš„ã€‚æ ¹æ®è‡ªå·±çš„éœ€æ±‚ç‰¹åˆ«è¦æ³¨æ„ä¸€ä¸‹æ¨¡å‹çš„tokenâ€¦</p>
<p>è£å§èŠAI
å‘è¡¨äºAIæ™ºèƒ½ä½“</p>
<p>é€‰æ‹©è¯­è¨€</p>
      </div>
      <div class="theme-toggle" id="themeToggle">ğŸŒ“</div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const themeToggle = document.getElementById('themeToggle');
        
        themeToggle.addEventListener('click', function() {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('vuepress-theme-hope-scheme', newTheme);
        });
      });
    </script>
  </body>
</html>
