---
description: 
globs: services/app/*
alwaysApply: false
---
# å¾®ä¿¡å°ç¨‹åºå¼€å‘è§„èŒƒ

## é¡¹ç›®ç»“æ„è§„èŒƒ

### æ ‡å‡†ç›®å½•ç»“æ„
```
services/app/
â”œâ”€â”€ components/        # è‡ªå®šä¹‰ç»„ä»¶
â”‚   â”œâ”€â”€ common/       # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ business/     # ä¸šåŠ¡ç»„ä»¶
â”‚   â””â”€â”€ ui/          # UIç»„ä»¶
â”œâ”€â”€ pages/            # é¡µé¢æ–‡ä»¶
â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”œâ”€â”€ api/             # APIæ¥å£å°è£…
â”œâ”€â”€ styles/          # å…¬å…±æ ·å¼
â”œâ”€â”€ behaviors/       # ç»„ä»¶è¡Œä¸º
â”œâ”€â”€ app.js           # å°ç¨‹åºå…¥å£æ–‡ä»¶
â”œâ”€â”€ app.json         # å…¨å±€é…ç½®
â””â”€â”€ app.wxss         # å…¨å±€æ ·å¼
```

### æ–‡ä»¶å‘½åè§„èŒƒ
```
# âœ… æ¨èçš„æ–‡ä»¶å‘½å
search-bar/           # ç»„ä»¶ç›®å½•ï¼šå°å†™è¿å­—ç¬¦
user-profile.js       # JSæ–‡ä»¶ï¼šå°å†™è¿å­—ç¬¦
api-client.js         # å·¥å…·æ–‡ä»¶ï¼šå°å†™è¿å­—ç¬¦
post-detail.wxml      # é¡µé¢æ–‡ä»¶ï¼šå°å†™è¿å­—ç¬¦

# âŒ é¿å…çš„å‘½å
SearchBar/            # é¿å…å¤§é©¼å³°ç›®å½•å
userProfile.js        # é¿å…å°é©¼å³°æ–‡ä»¶å
api_client.js         # é¿å…ä¸‹åˆ’çº¿ï¼ˆé™¤ç‰¹æ®Šæƒ…å†µï¼‰
```

## JavaScript ç¼–ç è§„èŒƒ

### 1. åŸºç¡€è¯­æ³•è§„èŒƒ
```javascript
// âœ… æ¨èçš„ä»£ç é£æ ¼
const userInfo = {
  openid: '',
  nickname: '',
  avatar: ''
}

// ä½¿ç”¨const/letï¼Œé¿å…var
const API_BASE_URL = 'https://api.nkuwiki.com'
let searchResults = []

// å‡½æ•°å‘½åï¼šåŠ¨è¯å¼€å¤´ï¼Œå°é©¼å³°
function getUserInfo() {
  return wx.getStorageSync('userInfo')
}

// å¼‚æ­¥å‡½æ•°ä¼˜å…ˆä½¿ç”¨async/await
async function searchKnowledge(query) {
  try {
    const result = await apiClient.post('/knowledge/search', { query })
    return result.data
  } catch (error) {
    console.error('æœç´¢å¤±è´¥:', error)
    throw error
  }
}
```

### 2. é¡µé¢/ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
```javascript
// é¡µé¢ç”Ÿå‘½å‘¨æœŸæ ‡å‡†æ¨¡æ¿
Page({
  data: {
    // é¡µé¢æ•°æ®
    query: '',
    searchResults: [],
    loading: false,
    hasMore: true
  },
  
  // é¡µé¢åŠ è½½
  onLoad(options) {
    console.log('é¡µé¢åŠ è½½:', options)
    this.initPage(options)
  },
  
  // é¡µé¢æ˜¾ç¤º
  onShow() {
    this.refreshUserInfo()
  },
  
  // é¡µé¢å¸è½½
  onUnload() {
    this.cleanup()
  },
  
  // è‡ªå®šä¹‰æ–¹æ³•
  async initPage(options) {
    const { query } = options
    if (query) {
      this.setData({ query })
      await this.performSearch(query)
    }
  },
  
  async performSearch(query) {
    if (!query.trim()) {
      wx.showToast({ title: 'è¯·è¾“å…¥æœç´¢å†…å®¹', icon: 'none' })
      return
    }
    
    this.setData({ loading: true })
    
    try {
      const results = await searchKnowledge(query)
      this.setData({ 
        searchResults: results,
        loading: false 
      })
    } catch (error) {
      this.setData({ loading: false })
      this.showError('æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•')
    }
  },
  
  // é”™è¯¯å¤„ç†
  showError(message) {
    wx.showToast({
      title: message,
      icon: 'none',
      duration: 2000
    })
  },
  
  // æ¸…ç†èµ„æº
  cleanup() {
    // æ¸…ç†å®šæ—¶å™¨ã€å–æ¶ˆè¯·æ±‚ç­‰
  }
})
```

### 3. ç»„ä»¶å®šä¹‰è§„èŒƒ
```javascript
// è‡ªå®šä¹‰ç»„ä»¶æ ‡å‡†æ¨¡æ¿
Component({
  // ç»„ä»¶å±æ€§
  properties: {
    placeholder: {
      type: String,
      value: 'è¯·è¾“å…¥æœç´¢å†…å®¹'
    },
    disabled: {
      type: Boolean,
      value: false
    }
  },
  
  // ç»„ä»¶æ•°æ®
  data: {
    inputValue: '',
    focused: false
  },
  
  // ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
  lifetimes: {
    attached() {
      // ç»„ä»¶å®ä¾‹è¿›å…¥é¡µé¢èŠ‚ç‚¹æ ‘æ—¶æ‰§è¡Œ
      console.log('SearchBarç»„ä»¶å·²æŒ‚è½½')
    },
    
    detached() {
      // ç»„ä»¶å®ä¾‹è¢«ä»é¡µé¢èŠ‚ç‚¹æ ‘ç§»é™¤æ—¶æ‰§è¡Œ
      this.cleanup()
    }
  },
  
  // é¡µé¢ç”Ÿå‘½å‘¨æœŸ
  pageLifetimes: {
    show() {
      // é¡µé¢æ˜¾ç¤ºæ—¶æ‰§è¡Œ
    },
    hide() {
      // é¡µé¢éšè—æ—¶æ‰§è¡Œ
    }
  },
  
  // ç»„ä»¶æ–¹æ³•
  methods: {
    onInput(e) {
      const value = e.detail.value
      this.setData({ inputValue: value })
      
      // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
      this.triggerEvent('input', { value })
    },
    
    onConfirm(e) {
      const value = e.detail.value.trim()
      if (!value) {
        wx.showToast({ title: 'è¯·è¾“å…¥æœç´¢å†…å®¹', icon: 'none' })
        return
      }
      
      this.triggerEvent('search', { query: value })
    },
    
    onFocus() {
      this.setData({ focused: true })
      this.triggerEvent('focus')
    },
    
    onBlur() {
      this.setData({ focused: false })
      this.triggerEvent('blur')
    },
    
    // æ¸…ç†æ–¹æ³•
    cleanup() {
      // æ¸…ç†å®šæ—¶å™¨ç­‰èµ„æº
    }
  }
})
```

## API è°ƒç”¨è§„èŒƒ

### 1. APIå®¢æˆ·ç«¯å°è£…
```javascript
// utils/api-client.js
class ApiClient {
  constructor() {
    this.baseURL = 'https://api.nkuwiki.com'
    this.timeout = 10000
  }
  
  // é€šç”¨è¯·æ±‚æ–¹æ³•
  async request(options) {
    const { url, method = 'GET', data, header = {} } = options
    
    // æ·»åŠ é€šç”¨è¯·æ±‚å¤´
    const defaultHeader = {
      'Content-Type': 'application/json',
      'Authorization': this.getAuthToken()
    }
    
    const requestHeader = { ...defaultHeader, ...header }
    
    return new Promise((resolve, reject) => {
      wx.request({
        url: `${this.baseURL}${url}`,
        method,
        data,
        header: requestHeader,
        timeout: this.timeout,
        success: (res) => {
          this.handleResponse(res, resolve, reject)
        },
        fail: (error) => {
          this.handleError(error, reject)
        }
      })
    })
  }
  
  // å“åº”å¤„ç†
  handleResponse(res, resolve, reject) {
    const { statusCode, data } = res
    
    if (statusCode === 200) {
      if (data.code === 200) {
        resolve(data)
      } else {
        reject(new Error(data.message || 'è¯·æ±‚å¤±è´¥'))
      }
    } else {
      reject(new Error(`HTTP ${statusCode}: ${this.getErrorMessage(statusCode)}`))
    }
  }
  
  // é”™è¯¯å¤„ç†
  handleError(error, reject) {
    let message = 'ç½‘ç»œè¯·æ±‚å¤±è´¥'
    
    if (error.errMsg) {
      if (error.errMsg.includes('timeout')) {
        message = 'è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥'
      } else if (error.errMsg.includes('fail')) {
        message = 'ç½‘ç»œè¿æ¥å¤±è´¥'
      }
    }
    
    reject(new Error(message))
  }
  
  // è·å–è®¤è¯token
  getAuthToken() {
    const userInfo = wx.getStorageSync('userInfo')
    return userInfo?.token || ''
  }
  
  // HTTPçŠ¶æ€ç é”™è¯¯ä¿¡æ¯
  getErrorMessage(statusCode) {
    const messages = {
      400: 'è¯·æ±‚å‚æ•°é”™è¯¯',
      401: 'æœªæˆæƒè®¿é—®',
      403: 'æƒé™ä¸è¶³',
      404: 'èµ„æºä¸å­˜åœ¨',
      500: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
      502: 'ç½‘å…³é”™è¯¯',
      503: 'æœåŠ¡ä¸å¯ç”¨'
    }
    return messages[statusCode] || 'æœªçŸ¥é”™è¯¯'
  }
  
  // GETè¯·æ±‚
  async get(url, params = {}) {
    const queryString = this.buildQueryString(params)
    const requestUrl = queryString ? `${url}?${queryString}` : url
    
    return this.request({
      url: requestUrl,
      method: 'GET'
    })
  }
  
  // POSTè¯·æ±‚
  async post(url, data = {}) {
    return this.request({
      url,
      method: 'POST',
      data
    })
  }
  
  // æ„å»ºæŸ¥è¯¢å­—ç¬¦ä¸²
  buildQueryString(params) {
    return Object.keys(params)
      .filter(key => params[key] !== undefined && params[key] !== null)
      .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
      .join('&')
  }
}

// å¯¼å‡ºå•ä¾‹
export default new ApiClient()
```

### 2. ä¸šåŠ¡APIå°è£…
```javascript
// api/knowledge.js
import apiClient from '../utils/api-client'

export const knowledgeApi = {
  // çŸ¥è¯†åº“æœç´¢
  async search(params) {
    const { query, page = 1, pageSize = 10, openid } = params
    
    if (!query || !query.trim()) {
      throw new Error('æœç´¢å…³é”®è¯ä¸èƒ½ä¸ºç©º')
    }
    
    if (!openid) {
      throw new Error('ç”¨æˆ·æ ‡è¯†ä¸èƒ½ä¸ºç©º')
    }
    
    return apiClient.post('/api/knowledge/advanced-search', {
      query: query.trim(),
      page,
      page_size: pageSize,
      openid
    })
  },
  
  // è·å–æœç´¢å»ºè®®
  async getSuggestions(query) {
    if (!query || query.length < 2) {
      return { data: [] }
    }
    
    return apiClient.get('/api/knowledge/suggestions', { query })
  },
  
  // è·å–çƒ­é—¨æœç´¢
  async getHotSearches() {
    return apiClient.get('/api/knowledge/hot-searches')
  },
  
  // è®°å½•æœç´¢å†å²
  async recordSearchHistory(openid, query) {
    return apiClient.post('/api/wxapp/search-history', {
      openid,
      query,
      timestamp: Date.now()
    })
  }
}
```

## ç”¨æˆ·äº¤äº’è§„èŒƒ

### 1. åŠ è½½çŠ¶æ€å¤„ç†
```javascript
// é¡µé¢æ–¹æ³•ç¤ºä¾‹
async loadData() {
  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  wx.showLoading({
    title: 'åŠ è½½ä¸­...',
    mask: true
  })
  
  try {
    const data = await this.fetchData()
    
    this.setData({ 
      list: data,
      loaded: true 
    })
    
    // æˆåŠŸæç¤ºï¼ˆå¯é€‰ï¼‰
    if (data.length === 0) {
      wx.showToast({
        title: 'æš‚æ— æ•°æ®',
        icon: 'none'
      })
    }
    
  } catch (error) {
    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error)
    
    // é”™è¯¯æç¤º
    wx.showToast({
      title: error.message || 'åŠ è½½å¤±è´¥',
      icon: 'none',
      duration: 2000
    })
    
  } finally {
    // éšè—åŠ è½½çŠ¶æ€
    wx.hideLoading()
  }
}

// ä¸‹æ‹‰åˆ·æ–°
async onPullDownRefresh() {
  try {
    await this.refreshData()
  } catch (error) {
    this.showError('åˆ·æ–°å¤±è´¥')
  } finally {
    wx.stopPullDownRefresh()
  }
}

// ä¸Šæ‹‰åŠ è½½æ›´å¤š
async onReachBottom() {
  if (this.data.loading || !this.data.hasMore) {
    return
  }
  
  this.setData({ loading: true })
  
  try {
    const newData = await this.loadMoreData()
    
    this.setData({
      list: [...this.data.list, ...newData],
      hasMore: newData.length > 0,
      loading: false
    })
    
  } catch (error) {
    this.setData({ loading: false })
    this.showError('åŠ è½½æ›´å¤šå¤±è´¥')
  }
}
```

### 2. ç”¨æˆ·åé¦ˆè§„èŒƒ
```javascript
// æˆåŠŸåé¦ˆ
showSuccess(message, duration = 1500) {
  wx.showToast({
    title: message,
    icon: 'success',
    duration
  })
}

// é”™è¯¯åé¦ˆ
showError(message, duration = 2000) {
  wx.showToast({
    title: message,
    icon: 'none',
    duration
  })
}

// ç¡®è®¤å¯¹è¯æ¡†
showConfirm(title, content) {
  return new Promise((resolve) => {
    wx.showModal({
      title,
      content,
      confirmText: 'ç¡®å®š',
      cancelText: 'å–æ¶ˆ',
      success: (res) => {
        resolve(res.confirm)
      },
      fail: () => {
        resolve(false)
      }
    })
  })
}

// æ“ä½œç¡®è®¤ç¤ºä¾‹
async deletePost(postId) {
  const confirmed = await this.showConfirm(
    'åˆ é™¤ç¡®è®¤',
    'ç¡®å®šè¦åˆ é™¤è¿™æ¡å¸–å­å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚'
  )
  
  if (!confirmed) {
    return
  }
  
  try {
    await postApi.delete(postId)
    this.showSuccess('åˆ é™¤æˆåŠŸ')
    this.refreshList()
  } catch (error) {
    this.showError('åˆ é™¤å¤±è´¥')
  }
}
```

## å­˜å‚¨å’Œç¼“å­˜è§„èŒƒ

### 1. æœ¬åœ°å­˜å‚¨ç®¡ç†
```javascript
// utils/storage.js
export const storage = {
  // è®¾ç½®ç”¨æˆ·ä¿¡æ¯
  setUserInfo(userInfo) {
    try {
      wx.setStorageSync('userInfo', userInfo)
      return true
    } catch (error) {
      console.error('ä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
      return false
    }
  },
  
  // è·å–ç”¨æˆ·ä¿¡æ¯
  getUserInfo() {
    try {
      return wx.getStorageSync('userInfo') || null
    } catch (error) {
      console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
      return null
    }
  },
  
  // è®¾ç½®æœç´¢å†å²
  setSearchHistory(history) {
    try {
      const maxLength = 20 // æœ€å¤šä¿å­˜20æ¡å†å²
      const limitedHistory = history.slice(0, maxLength)
      wx.setStorageSync('searchHistory', limitedHistory)
      return true
    } catch (error) {
      console.error('ä¿å­˜æœç´¢å†å²å¤±è´¥:', error)
      return false
    }
  },
  
  // è·å–æœç´¢å†å²
  getSearchHistory() {
    try {
      return wx.getStorageSync('searchHistory') || []
    } catch (error) {
      console.error('è·å–æœç´¢å†å²å¤±è´¥:', error)
      return []
    }
  },
  
  // æ·»åŠ æœç´¢è®°å½•
  addSearchRecord(query) {
    if (!query || !query.trim()) {
      return
    }
    
    const history = this.getSearchHistory()
    const trimmedQuery = query.trim()
    
    // ç§»é™¤é‡å¤é¡¹
    const newHistory = [trimmedQuery, ...history.filter(item => item !== trimmedQuery)]
    
    this.setSearchHistory(newHistory)
  },
  
  // æ¸…é™¤æ‰€æœ‰æ•°æ®
  clear() {
    try {
      wx.clearStorageSync()
      return true
    } catch (error) {
      console.error('æ¸…é™¤å­˜å‚¨å¤±è´¥:', error)
      return false
    }
  },
  
  // ç§»é™¤æŒ‡å®škey
  remove(key) {
    try {
      wx.removeStorageSync(key)
      return true
    } catch (error) {
      console.error(`ç§»é™¤å­˜å‚¨${key}å¤±è´¥:`, error)
      return false
    }
  }
}
```

### 2. ç¼“å­˜ç­–ç•¥
```javascript
// utils/cache.js
class CacheManager {
  constructor() {
    this.cachePrefix = 'nkuwiki_cache_'
    this.defaultTTL = 5 * 60 * 1000 // 5åˆ†é’Ÿ
  }
  
  // è®¾ç½®ç¼“å­˜
  set(key, data, ttl = this.defaultTTL) {
    const cacheKey = this.cachePrefix + key
    const cacheData = {
      data,
      timestamp: Date.now(),
      ttl
    }
    
    try {
      wx.setStorageSync(cacheKey, cacheData)
      return true
    } catch (error) {
      console.error('è®¾ç½®ç¼“å­˜å¤±è´¥:', error)
      return false
    }
  }
  
  // è·å–ç¼“å­˜
  get(key) {
    const cacheKey = this.cachePrefix + key
    
    try {
      const cacheData = wx.getStorageSync(cacheKey)
      
      if (!cacheData) {
        return null
      }
      
      // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
      const { data, timestamp, ttl } = cacheData
      if (Date.now() - timestamp > ttl) {
        this.remove(key)
        return null
      }
      
      return data
    } catch (error) {
      console.error('è·å–ç¼“å­˜å¤±è´¥:', error)
      return null
    }
  }
  
  // ç§»é™¤ç¼“å­˜
  remove(key) {
    const cacheKey = this.cachePrefix + key
    
    try {
      wx.removeStorageSync(cacheKey)
      return true
    } catch (error) {
      console.error('ç§»é™¤ç¼“å­˜å¤±è´¥:', error)
      return false
    }
  }
  
  // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
  clearAll() {
    try {
      const { keys } = wx.getStorageInfoSync()
      
      keys.forEach(key => {
        if (key.startsWith(this.cachePrefix)) {
          wx.removeStorageSync(key)
        }
      })
      
      return true
    } catch (error) {
      console.error('æ¸…é™¤ç¼“å­˜å¤±è´¥:', error)
      return false
    }
  }
}

export default new CacheManager()
```

## æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### 1. å›¾ç‰‡å¤„ç†
```javascript
// å›¾ç‰‡æ‡’åŠ è½½ç»„ä»¶ä½¿ç”¨
// wxml
<image 
  src="{{item.imageUrl}}" 
  lazy-load="{{true}}"
  mode="aspectFill"
  loading="eager"
  bindload="onImageLoad"
  binderror="onImageError"
/>

// js
onImageLoad(e) {
  console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ')
},

onImageError(e) {
  console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', e.detail.errMsg)
  // å¯ä»¥è®¾ç½®é»˜è®¤å›¾ç‰‡
  // this.setData({ 'list[index].imageUrl': '/images/default-avatar.png' })
}

// å›¾ç‰‡å‹ç¼©å·¥å…·
export const imageUtils = {
  // å‹ç¼©å›¾ç‰‡
  compressImage(filePath, quality = 80) {
    return new Promise((resolve, reject) => {
      wx.compressImage({
        src: filePath,
        quality,
        success: resolve,
        fail: reject
      })
    })
  },
  
  // è·å–å›¾ç‰‡ä¿¡æ¯
  getImageInfo(src) {
    return new Promise((resolve, reject) => {
      wx.getImageInfo({
        src,
        success: resolve,
        fail: reject
      })
    })
  }
}
```

### 2. æ•°æ®ä¼˜åŒ–
```javascript
// æ•°æ®åˆ†é¡µåŠ è½½
async loadPage(page = 1, pageSize = 10) {
  const cacheKey = `page_${page}_${pageSize}`
  
  // å°è¯•ä»ç¼“å­˜è·å–
  let data = cache.get(cacheKey)
  
  if (!data) {
    // ä»APIè·å–
    data = await this.fetchPageData(page, pageSize)
    
    // ç¼“å­˜æ•°æ®
    cache.set(cacheKey, data, 2 * 60 * 1000) // 2åˆ†é’Ÿç¼“å­˜
  }
  
  return data
}

// é˜²æŠ–æœç´¢
debounceSearch: null,

onSearchInput(e) {
  const query = e.detail.value
  
  // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
  if (this.debounceSearch) {
    clearTimeout(this.debounceSearch)
  }
  
  // è®¾ç½®æ–°çš„å®šæ—¶å™¨
  this.debounceSearch = setTimeout(() => {
    this.performSearch(query)
  }, 500) // 500msé˜²æŠ–
},

// èŠ‚æµæ»šåŠ¨
throttleScroll: null,
scrollTop: 0,

onPageScroll(e) {
  if (this.throttleScroll) {
    return
  }
  
  this.throttleScroll = setTimeout(() => {
    this.scrollTop = e.scrollTop
    this.handleScroll()
    this.throttleScroll = null
  }, 100) // 100msèŠ‚æµ
}
```

## ç»„ä»¶å¼€å‘è§„èŒƒ

### 1. å¯å¤ç”¨ç»„ä»¶è®¾è®¡
```javascript
// components/post-item/index.js
Component({
  properties: {
    post: {
      type: Object,
      required: true
    },
    showActions: {
      type: Boolean,
      value: true
    },
    compact: {
      type: Boolean,
      value: false
    }
  },
  
  data: {
    liked: false,
    likeCount: 0
  },
  
  lifetimes: {
    attached() {
      this.initComponent()
    }
  },
  
  methods: {
    initComponent() {
      const { post } = this.data
      if (post) {
        this.setData({
          liked: post.liked || false,
          likeCount: post.likeCount || 0
        })
      }
    },
    
    // ç‚¹å‡»å¸–å­
    onTapPost() {
      const { post } = this.data
      this.triggerEvent('tap', { post })
    },
    
    // ç‚¹èµæ“ä½œ
    async onLike() {
      const { post, liked, likeCount } = this.data
      
      try {
        // ä¹è§‚æ›´æ–°UI
        this.setData({
          liked: !liked,
          likeCount: liked ? likeCount - 1 : likeCount + 1
        })
        
        // è°ƒç”¨API
        await postApi.toggleLike(post.id, !liked)
        
        // è§¦å‘äº‹ä»¶é€šçŸ¥çˆ¶ç»„ä»¶
        this.triggerEvent('like', {
          postId: post.id,
          liked: !liked
        })
        
      } catch (error) {
        // å›æ»šUI
        this.setData({
          liked,
          likeCount
        })
        
        wx.showToast({
          title: 'æ“ä½œå¤±è´¥',
          icon: 'none'
        })
      }
    },
    
    // åˆ†äº«æ“ä½œ
    onShare() {
      const { post } = this.data
      this.triggerEvent('share', { post })
    }
  }
})
```

### 2. ç»„ä»¶æ ·å¼è§„èŒƒ
```css
/* components/post-item/index.wxss */

/* ç»„ä»¶æ ¹å®¹å™¨ */
.post-item {
  background: #fff;
  border-radius: 12rpx;
  margin: 20rpx;
  padding: 24rpx;
  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);
}

/* ç´§å‡‘æ¨¡å¼ */
.post-item.compact {
  margin: 10rpx;
  padding: 16rpx;
}

/* æ ‡é¢˜æ ·å¼ */
.post-title {
  font-size: 32rpx;
  font-weight: 600;
  color: #333;
  line-height: 1.4;
  margin-bottom: 16rpx;
  
  /* æ–‡æœ¬æˆªæ–­ */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  overflow: hidden;
}

/* å†…å®¹æ ·å¼ */
.post-content {
  font-size: 28rpx;
  color: #666;
  line-height: 1.5;
  margin-bottom: 20rpx;
  
  /* æ–‡æœ¬æˆªæ–­ */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 3;
  overflow: hidden;
}

/* æ“ä½œæ  */
.post-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 16rpx;
  border-top: 1rpx solid #f0f0f0;
}

/* ç‚¹èµæŒ‰é’® */
.like-btn {
  display: flex;
  align-items: center;
  padding: 8rpx 16rpx;
  border-radius: 20rpx;
  background: #f8f8f8;
  transition: all 0.3s ease;
}

.like-btn.liked {
  background: #ffe6e6;
  color: #ff4757;
}

.like-icon {
  width: 32rpx;
  height: 32rpx;
  margin-right: 8rpx;
}

.like-count {
  font-size: 24rpx;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 375px) {
  .post-title {
    font-size: 30rpx;
  }
  
  .post-content {
    font-size: 26rpx;
  }
}
```

## é”™è¯¯å¤„ç†å’Œè°ƒè¯•

### 1. å…¨å±€é”™è¯¯å¤„ç†
```javascript
// app.js
App({
  onLaunch() {
    this.initErrorHandler()
  },
  
  // åˆå§‹åŒ–é”™è¯¯å¤„ç†
  initErrorHandler() {
    // ç›‘å¬å°ç¨‹åºé”™è¯¯
    wx.onError((error) => {
      console.error('å°ç¨‹åºé”™è¯¯:', error)
      this.reportError('miniprogram_error', error)
    })
    
    // ç›‘å¬æœªå¤„ç†çš„Promiseæ‹’ç»
    wx.onUnhandledRejection((event) => {
      console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', event)
      this.reportError('unhandled_rejection', event.reason)
    })
  },
  
  // é”™è¯¯ä¸ŠæŠ¥
  reportError(type, error) {
    // åªåœ¨ç”Ÿäº§ç¯å¢ƒä¸ŠæŠ¥
    if (this.globalData.env !== 'production') {
      return
    }
    
    const errorInfo = {
      type,
      message: error.message || error,
      stack: error.stack,
      timestamp: Date.now(),
      userAgent: wx.getSystemInfoSync(),
      userId: this.globalData.userInfo?.openid
    }
    
    // ä¸ŠæŠ¥åˆ°é”™è¯¯ç›‘æ§æœåŠ¡
    wx.request({
      url: 'https://api.nkuwiki.com/api/error-report',
      method: 'POST',
      data: errorInfo,
      success: () => {
        console.log('é”™è¯¯ä¸ŠæŠ¥æˆåŠŸ')
      },
      fail: (err) => {
        console.error('é”™è¯¯ä¸ŠæŠ¥å¤±è´¥:', err)
      }
    })
  }
})
```

### 2. è°ƒè¯•å·¥å…·
```javascript
// utils/debug.js
class DebugHelper {
  constructor() {
    this.isDebug = wx.getAccountInfoSync().miniProgram.envVersion !== 'release'
  }
  
  // è°ƒè¯•æ—¥å¿—
  log(...args) {
    if (this.isDebug) {
      console.log('[DEBUG]', ...args)
    }
  }
  
  // æ€§èƒ½ç›‘æ§
  time(label) {
    if (this.isDebug) {
      console.time(label)
    }
  }
  
  timeEnd(label) {
    if (this.isDebug) {
      console.timeEnd(label)
    }
  }
  
  // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
  showDebugInfo(title, data) {
    if (!this.isDebug) {
      return
    }
    
    wx.showModal({
      title: `è°ƒè¯•ä¿¡æ¯: ${title}`,
      content: JSON.stringify(data, null, 2),
      showCancel: false
    })
  }
  
  // ç½‘ç»œè¯·æ±‚æ—¥å¿—
  logRequest(url, options, response) {
    if (!this.isDebug) {
      return
    }
    
    console.group('ğŸŒ APIè¯·æ±‚')
    console.log('URL:', url)
    console.log('è¯·æ±‚å‚æ•°:', options)
    console.log('å“åº”æ•°æ®:', response)
    console.groupEnd()
  }
}

export default new DebugHelper()
```
